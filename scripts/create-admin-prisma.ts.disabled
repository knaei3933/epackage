/**
 * Quick Admin Account Creation Script (for Development)
 *
 * Creates an admin user directly in the database using Prisma
 * Usage: npx tsx scripts/create-admin-prisma.ts <email> <password>
 */

import { PrismaClient } from '@prisma/client';
import * as bcrypt from 'bcrypt';
import { config } from 'dotenv';

// Load env variables
config({ path: '.env.local' });

const prisma = new PrismaClient();

// Get email and password from command line arguments
const email = process.argv[2] || 'admin@epackage-lab.com';
const password = process.argv[3] || 'Admin1234';

async function createAdminUser() {
  console.log(`\nğŸ” Creating admin user: ${email}`);
  console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');

  try {
    // Check if user already exists
    console.log('1. Checking if user exists...');
    const existingUser = await prisma.user.findUnique({
      where: { email },
    });

    let userId: string;

    if (existingUser) {
      console.log('âš ï¸  User already exists, updating to admin...');
      userId = existingUser.id;

      // Update existing user to admin
      await prisma.user.update({
        where: { id: userId },
        data: {
          role: 'ADMIN',
          status: 'ACTIVE',
        },
      });

      console.log('âœ… User updated to ADMIN role');
    } else {
      // Hash the password
      console.log('2. Hashing password...');
      const hashedPassword = await bcrypt.hash(password, 10);

      // Create new user
      console.log('3. Creating new user...');
      const newUser = await prisma.user.create({
        data: {
          email,
          password: hashedPassword,
          emailVerified: new Date(), // Auto-verify for development
          kanjiLastName: 'ç®¡ç†',
          kanjiFirstName: 'è€…',
          kanaLastName: 'ã‹ã‚“ã‚Š',
          kanaFirstName: 'ã—ã‚ƒ',
          businessType: 'CORPORATION',
          productCategory: 'OTHER',
          role: 'ADMIN',
          status: 'ACTIVE',
          lastLoginAt: new Date(),
        },
      });

      userId = newUser.id;
      console.log('âœ… User created:', userId);
    }

    // Verify the user
    console.log('\n4. Verifying admin user...');
    const user = await prisma.user.findUnique({
      where: { id: userId },
      select: {
        id: true,
        email: true,
        role: true,
        status: true,
        createdAt: true,
      },
    });

    if (user) {
      console.log('\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
      console.log('âœ… Admin account ready!\n');
      console.log('ğŸ“§ Email:', email);
      console.log('ğŸ”‘ Password:', password);
      console.log('ğŸ‘¤ Name: ç®¡ç† è€… (Kanri Sha)');
      console.log('ğŸ” Role:', user.role);
      console.log('ğŸ“Š Status:', user.status);
      console.log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');
      console.log('ğŸŒ Login at: http://localhost:3000/signin\n');
    }

  } catch (error) {
    console.error('âŒ Error:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

createAdminUser()
  .then(() => {
    console.log('âœ… Done!');
    process.exit(0);
  })
  .catch((error) => {
    console.error('âŒ Failed:', error);
    process.exit(1);
  });
