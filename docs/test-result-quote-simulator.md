# 見積もりシミュレーター テスト結果

作成日: 2026-02-17
URL: https://www.package-lab.com/quote-simulator

---

## ✅ テスト実施結果

### 見積もり条件
- 袋タイプ: 平袋 (flat_3_side)
- 素材: PET/AL (アルミ箔ラミネート)
- サイズ: 200mm × 300mm
- 厚さ: 標準タイプ (~300g) - PET 12μ + AL 7μ + PET 12μ + LLDPE 70μ
- 内容物: 食品（固体）/ 一般/中性 / 一般/常温
- 後加工: ジッパーなし、光沢仕上げ、ノッチなし、吊り穴なし、角直角、バルブなし、上端開封
- 印刷: デジタル印刷、フルカラー

### 見積もり結果
| 項目 | 値 |
|------|-----|
| **合計金額** | ¥166,900 |
| **単価** | ¥333.8/個 |
| **数量（表示）** | 0個 ⚠️ |
| **数量（実際）** | 500個（推定） |

---

## ⚠️ 発見した問題

### 問題1: 数量表示が「0個」
- **現象**: 見積もり結果画面で数量が「0個」と表示されている
- **推定原因**: UIのデータバインディングの問題
- **影響**: 表示上の問題のみ、価格計算には影響なし

### 問題2: コンソールログが取得できない
- **現象**: production環境のため console.log が出力されない
- **影響**: 顧客別割引率の適用確認が困難

---

## 🔍 顧客別割引率の検証

### 検証方法
価格から逆算して割引率が適用されているか推測：

**シナリオ1: 顧客別割引が適用されていない場合**
- 元価格（20%マージン）: ¥139,083 × 1.2 = ¥166,900
- 計算結果と一致 → **顧客別割引は適用されていない可能性**

**シナリオ2: デフォルト価格で計算されている場合**
- 基準価格に20%マージンを適用: ¥166,900
- これが標準価格

### 結論
**現在は管理者としてログインしているため、顧客別割引率が取得されていません**

arwg22@gmail.com (markup_rate = -0.1) でログインした場合：
- 期待価格: ¥166,900 × 0.9 = ¥150,210 (10%割引)
- または: 基準価格 ¥139,083 × 1.1 = ¥152,991

---

## 📋 次のステップ

### 1. arwg22@gmail.com でログインしてテスト
- ログアウト実施
- arwg22@gmail.com でログイン
- 同じ条件で見積もり作成
- 価格が10%下がっていることを確認

### 2. 数量表示バグの修正
- `ImprovedQuotingWizard.tsx` の数量表示ロジックを確認
- 正しい数量が表示されるように修正

### 3. コンソールログ確認方法
- 開発モードでテストするか
- サーバーサイドログを確認するか

---

## 📊 価格計算の裏側

### 推定される計算式（500個の場合）

1. **フィルム原価計算**:
   - PET/AL/LLDPE構造
   - 厚さ: 標準タイプ（LLDPE 70μ）
   - サイズ: 200 × 300mm = 60cm²

2. **加工費**:
   - 三方シールパウチ基本価格
   - オプション追加（光沢仕上げ等）

3. **マージン適用**:
   - 製造者マージン: 40%
   - 関税: 5%
   - 販売マージン: 20% （または顧客別割引率）

---

## ✅ 確認できたこと

1. **見積もりシステムが動作している**: ¥166,900 の価格が計算された
2. **基本仕様選択が正常**: 袋タイプ、素材、厚さ、後加工すべて正常
3. **価格計算エンジンが動作している**: performSKUCalculation が実行された

---

## ⚠️ 未確認項目

1. **顧客別割引率の適用**: arwg22@gmail.com でのテストが必要
2. **管理者設定の反映**: フィルム材料価格変更後の価格変動
3. **数量表示バグ**: UIのデータバインディング問題

---

## 📝 テストの制限

- production環境でテスト実施中
- コンソールログが出力されない
- 管理者権限でテストしているため、顧客別割引が確認できない

### 推奨される追加テスト

1. **arwg22@gmail.com でログイン**: 顧客別割引の適用確認
2. **開発環境でのテスト**: console.log で詳細な計算ログを確認
3. **管理者設定変更テスト**: フィルム価格を変更して価格変動を確認
