# Epackage Lab B2Bã‚·ã‚¹ãƒ†ãƒ  TASK v5.0 - æŠ€è¡“ç·¨

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 5.0
**ä½œæˆæ—¥**: 2026-01-30
**åŒºåˆ†**: æŠ€è¡“å®Ÿè£…ãƒ»ä½œæ¥­è¨ˆç”»

---

## 1. ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ç¾çŠ¶ï¼ˆ2026-01-30åˆ†æï¼‰

### 1.1 ã‚¹ã‚±ãƒ¼ãƒ«çµ±è¨ˆ

| ã‚«ãƒ†ã‚´ãƒª | æ–‡æ›¸å€¤ | å®Ÿéš›å€¤ | å·®ç•° | çŠ¶æ…‹ |
|----------|--------|--------|------|------|
| **APIãƒ«ãƒ¼ãƒˆ** | 184 | **194** | +10 | ğŸ“ è¦æ›´æ–° |
| **ãƒšãƒ¼ã‚¸æ•°** | 95 | **88** | -7 | ğŸ“ è¦æ›´æ–° |
| **Loadingãƒšãƒ¼ã‚¸** | 5 | **6** | +1 | ğŸ“ è¦æ›´æ–° |
| **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** | 305 | **274** | -31 | ğŸ“ è¦æ›´æ–° |
| **\*Client.tsx** | 0 | **11** | +11 | ğŸ†• æ–°è¦è¿½åŠ  |

### 1.2 æ–°è¦APIï¼ˆ10å€‹è¿½åŠ ï¼‰

```typescript
// Unified Notifications API (5å€‹)
src/app/api/notifications/route.ts
src/app/api/notifications/[id]/read/route.ts
src/app/api/notifications/mark-all-read/route.ts
src/app/api/notifications/delete-all/route.ts
src/app/api/notifications/unread-count/route.ts

// Unified Dashboard API (2å€‹)
src/app/api/member/dashboard/unified-stats/route.ts
src/app/api/admin/dashboard/unified-stats/route.ts

// RBACé–¢é€£ (3å€‹)
src/app/api/admin/quotations/guest-save/route.ts
src/app/member/invites/send/route.ts
src/app/api/revalidate/route.ts
```

### 1.3 *Client.tsx ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ11å€‹ï¼‰

Next.js 16 App Routeræœ€é©åŒ–ã«ã‚ˆã‚‹Server/Clientåˆ†é›¢ï¼š

```
src/app/catalog/CatalogClient.tsx
src/app/catalog/[slug]/ProductDetailClient.tsx
src/app/member/dashboard/UnifiedDashboardClient.tsx
src/app/admin/dashboard/AdminDashboardClient.tsx
src/app/admin/quotations/AdminQuotationsClient.tsx
src/app/admin/approvals/AdminApprovalsClient.tsx
src/app/admin/orders/AdminOrdersClient.tsx
src/app/member/quotations/QuotationsClient.tsx
src/app/cart/CartPageClient.tsx
src/app/compare/ComparisonClient.tsx
src/app/news/NewsClient.tsx
```

---

## 2. B2Bãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè£…è¨ˆç”»ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ï¼‰

### 2.1 è¦æœ› vs æ—¢å­˜PRDå¯¾å¿œ

| è¦æœ›ã‚¹ãƒ†ãƒ¼ã‚¸ | æ—¢å­˜PRD | çŠ¶æ…‹ |
|-------------|----------|------|
| 1. è¦‹ç© â†’ æ³¨æ–‡ | Stage 1-3 | âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆæ³¨æ–‡ç¢ºå®šãƒœã‚¿ãƒ³ã®ã¿ä¿®æ­£ï¼‰ |
| 2. å…¥ç¨¿ç”¨ãƒ‡ãƒ¼ã‚¿DL | Stage 5 | âœ… å®Ÿè£…æ¸ˆã¿ |
| 3. ãƒ‡ãƒ¼ã‚¿å…¥ç¨¿ | Stage 5 | âœ… å®Ÿè£…æ¸ˆã¿ |
| 4. éŸ“å›½ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼é€ä»˜/è¿”å´ | Stage 6-7 | â¸ï¸ ãƒ¡ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹å®Ÿè£…å¿…è¦ |
| 5. é¡§å®¢æ‰¿èª/å†è¦æ±‚ãƒ«ãƒ¼ãƒ— | Stage 8 | â¸ï¸ å®Ÿè£…å¿…è¦ |
| 6. å…¥é‡‘ç¢ºèª | - | âš ï¸ PRDã«ãªã—ã€æ–°è¦è¿½åŠ  |
| 7. è£½é€ æ‰¿èªï¼ˆå…¥é‡‘+ãƒ‡ãƒ¼ã‚¿ï¼‰ | Stage 9-10 | âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆå…¥é‡‘æ¡ä»¶è¿½åŠ ï¼‰ |
| 8. éŸ“å›½ç™ºæ³¨æ›¸é€ä»˜ | Stage 10 | â¸ï¸ ãƒ¡ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹å®Ÿè£…å¿…è¦ |
| 9. é€çŠ¶ç•ªå·/åˆ°ç€äºˆå®šå…¥åŠ› | Stage 11 | âœ… å®Ÿè£…æ¸ˆã¿ |
| 10. ç´å“æ›¸é€ä»˜ | Stage 12 | âœ… å®Ÿè£…æ¸ˆã¿ |
| 11. 3ãƒ¶æœˆå¾Œè‡ªå‹•æ•´ç† | - | âš ï¸ PRDã«ãªã—ã€æ–°è¦è¿½åŠ  |

### 2.2 Sprintè¨ˆç”»

#### Sprint 0: æ–‡æ›¸æœ€æ–°åŒ–ï¼ˆ1æ—¥ï¼‰â­ å…ˆè¡Œ
- [x] README.mdçµ±è¨ˆæ›´æ–°
- [ ] pages/structure.mdãƒšãƒ¼ã‚¸æ•°ä¿®æ­£
- [ ] api/routes-categorized.md APIè¿½åŠ 
- [ ] SUMMARY.mdæ—¥ä»˜èª¤ã‚Šä¿®æ­£
- [ ] PRDçµ±åˆï¼ˆv5.0ï¼‰

#### Sprint 1: æ³¨æ–‡ç¢ºå®šæ©Ÿèƒ½ï¼ˆ1æ—¥ï¼‰
1. ã€Œæ³¨æ–‡ç¢ºå®šã€ãƒœã‚¿ãƒ³å®Ÿè£…
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/member/quotations/[id]/page.tsx`
   - å¤‰æ›´å†…å®¹: ç¾åœ¨ã€Œæ³¨æ–‡ã™ã‚‹ã€ãƒœã‚¿ãƒ³ â†’ ç¢ºå®šãƒœã‚¿ãƒ³ã«å¤‰æ›´
   - API: `POST /api/member/orders`ã§æ³¨æ–‡ä½œæˆ
   - é·ç§»: `/member/orders/{id}`ãƒšãƒ¼ã‚¸ã¸

2. æ³¨æ–‡ä½œæˆAPIç¢ºèª
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/member/orders/route.ts`
   - æ—¢å­˜å®Ÿè£…: ã™ã§ã«å­˜åœ¨ã€`DATA_RECEIVED`çŠ¶æ…‹ã§æ³¨æ–‡ä½œæˆ

#### Sprint 2: ãƒ‡ãƒ¼ã‚¿å…¥ç¨¿åŠã³éŸ“å›½é€ä»˜ï¼ˆ2æ—¥ï¼‰
3. é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/member/orders/[id]/data-upload/page.tsx`ï¼ˆä¿®æ­£ï¼‰
   - æ©Ÿèƒ½:
     - ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆAI, PDF, PSD, EPSç­‰ï¼‰
     - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²æ—è¡¨ç¤º
     - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆ100MBï¼‰
     - AIè‡ªå‹•æŠ½å‡ºï¼ˆæ—¢å­˜`ai-parser`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ´»ç”¨ï¼‰
   - API: `POST /api/member/orders/{id}/files`

4. éŸ“å›½ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ãƒ¡ãƒ¼ãƒ«é€ä»˜
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/admin/orders/{id}/send-to-korea/route.ts`ï¼ˆæ–°è¦ï¼‰
   - æ©Ÿèƒ½:
     - ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã«AIæŠ½å‡ºãƒ‡ãƒ¼ã‚¿è©³ç´°è¨˜è¼‰
     - å…ƒãƒ‡ã‚¶ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜
     - ç™ºä¿¡: design@epackage-lab.com â†’ å®›å…ˆ: info@epackage-lab.com
   - ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹é€ :
     ```email
     Subject: [JP-{orderNumber}] ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿å…¥ç¨¿ - {companyName}

     æ³¨æ–‡åŸºæœ¬æƒ…å ±:
     - æ³¨æ–‡ç•ªå·: JP-2025-001
     - é¡§å®¢: {companyName}
     - æ‹…å½“è€…: {name} ({email})
     - é€£çµ¡å…ˆ: {phone}
     - æ³¨æ–‡æ—¥: {date}
     - å¸Œæœ›ç´æœŸ: {dueDate}

     è£½å“ä»•æ§˜ (AIè‡ªå‹•æŠ½å‡º):
     - å½¢å¼: {bagType}
     - ã‚µã‚¤ã‚º: {width}mm x {height}mm x {depth}mm
     - æè³ª: {material}
     - åšã•: {thickness}
     - ã‚¸ãƒƒãƒ‘ãƒ¼: {zipperSpec}

     å°åˆ·ä»•æ§˜:
     - å°åˆ·æ–¹å¼: {printingType}
     - è‰²ãƒ¢ãƒ¼ãƒ‰: {colorMode}
     - è‰²ã‚³ãƒ¼ãƒ‰: {colors}

     ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ:
     - è£½å“å: {productName}
     - ãƒ­ã‚´: {hasLogo}
     - ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: {hasBarcode}

     æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«:
     1. {fileName} ({fileSize})
     ...
     ```

5. AIæŠ½å‡ºãƒ‡ãƒ¼ã‚¿DBä¿å­˜
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/lib/ai-parser.ts`ï¼ˆæ—¢å­˜æ´»ç”¨ï¼‰
   - ä¿å­˜å ´æ‰€: `orders.design_data_extracted` (JSONB)

#### Sprint 3: ä¿®æ­£ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆ2æ—¥ï¼‰
6. ç®¡ç†è€…ä¿®æ­£ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/admin/orders/{id}/correction-upload/page.tsx`ï¼ˆæ–°è¦ï¼‰
   - UIæ§‹é€ :
     ```
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  ä¿®æ­£ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ - JP-2025-001                          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                                                 â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
     â”‚  â”‚  ğŸ“ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ (JPG)                        â”‚    â”‚
     â”‚  â”‚  è¦ä»¶: JPEG, 1920x1080pxä»¥ä¸Š, 2MBä»¥ä¸‹                 â”‚    â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
     â”‚                                                                 â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
     â”‚  â”‚  ğŸ“ å…ƒãƒ‡ã‚¶ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ« (AI/PDF/PSD/EPS)                â”‚    â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
     â”‚                                                                 â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
     â”‚  â”‚  ğŸ“ ä¿®æ­£ã‚³ãƒ¡ãƒ³ãƒˆ                                        â”‚    â”‚
     â”‚  â”‚  è‰²è£œæ­£ã€ãƒ†ã‚­ã‚¹ãƒˆä¿®æ­£ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ç­‰...            â”‚    â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
     â”‚                                                                 â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
     â”‚  â”‚  â˜‘ï¸ é¡§å®¢ã¸å³æ™‚æ‰¿èªè¦æ±‚é€ä¿¡                               â”‚    â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
     â”‚                                                                 â”‚
     â”‚              [ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰] [ã‚­ãƒ£ãƒ³ã‚»ãƒ«]                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     ```

7. ä¿®æ­£ãƒ‡ãƒ¼ã‚¿ä¿å­˜API
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/admin/orders/{id}/correction/route.ts`ï¼ˆæ–°è¦ï¼‰
   - æ©Ÿèƒ½:
     - Supabase Storageã«ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
     - `design_revisions`ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¨˜éŒ²ä½œæˆ
     - é¡§å®¢é€šçŸ¥ç™ºä¿¡ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰
   - DBä¿å­˜:
     ```sql
     INSERT INTO design_revisions (
       order_id, revision_number, corrected_files, partner_comment
     ) VALUES (
       $1, $2, $3, $4
     );
     ```

#### Sprint 4: æ‰¿èª/å†è¦æ±‚ãƒ«ãƒ¼ãƒ—ï¼ˆ2æ—¥ï¼‰
8. é¡§å®¢ä»•æ§˜æ›¸ç¢ºèªãƒšãƒ¼ã‚¸
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/member/orders/[id]/spec-approval/page.tsx`ï¼ˆæ–°è¦ï¼‰
   - æ©Ÿèƒ½:
     - ä¿®æ­£ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆJPGï¼‰
     - å…ƒç‰ˆ vs ä¿®æ­£æ¯”è¼ƒ
     - 3ç¨®é¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:
       1. âœ… æ‰¿èª â†’ æ¬¡ã‚¹ãƒ†ãƒ¼ã‚¸
       2. ğŸ”„ ä¿®æ­£è¦æ±‚ â†’ Stage 6-8 ãƒ«ãƒ¼ãƒ—
       3. âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ« â†’ æ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«

9. æ‰¿èª/å†è¦æ±‚API
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/member/orders/{id}/spec-approval/route.ts`ï¼ˆæ–°è¦ï¼‰
   - ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ¥å‡¦ç†:
     - **æ‰¿èª**: `orders.current_stage = 'CONTRACT'`, å¥‘ç´„ãƒ—ãƒ­ã‚»ã‚¹é–‹å§‹
     - **ä¿®æ­£è¦æ±‚**: `orders.current_stage = 'DATA_TO_KR'`, ä¿®æ­£è¦æ±‚äº‹ç”±ä¿å­˜

#### Sprint 5: å…¥é‡‘ç¢ºèªæ©Ÿèƒ½ï¼ˆ1æ—¥ï¼‰
10. ç®¡ç†è€…å…¥é‡‘ç¢ºèªãƒšãƒ¼ã‚¸
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/admin/orders/{id}/payment-confirmation/page.tsx`ï¼ˆæ–°è¦ï¼‰
    - æ©Ÿèƒ½:
      - æ³¨æ–‡é‡‘é¡è¡¨ç¤º
      - å…¥é‡‘é¡å…¥åŠ›
      - å…¥é‡‘æ—¥å…¥åŠ›
      - å…¥é‡‘ç¢ºèªãƒœã‚¿ãƒ³
      - å…¥é‡‘å®Œäº†æ™‚`payment_confirmed_at`ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä¿å­˜

11. å…¥é‡‘ç¢ºèªAPI
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/admin/orders/{id}/payment-confirmation/route.ts`ï¼ˆæ–°è¦ï¼‰
    ```typescript
    await supabase
      .from('orders')
      .update({
        payment_confirmed_at: new Date().toISOString(),
        payment_amount: amount,
      })
      .eq('id', orderId);
    ```

#### Sprint 6: è£½é€ æ‰¿èªï¼ˆå…¥é‡‘+ãƒ‡ãƒ¼ã‚¿æ‰¿èªæ¡ä»¶ï¼‰ï¼ˆ1æ—¥ï¼‰
12. è£½é€ é–‹å§‹æ¡ä»¶æ¤œè¨¼
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/lib/production-actions.ts`ï¼ˆæ—¢å­˜ä¿®æ­£ï¼‰
    - æ¡ä»¶è¿½åŠ :
      ```typescript
      function canStartProduction(order: Order): boolean {
        return (
          order.payment_confirmed_at !== null &&  // å…¥é‡‘ç¢ºèª
          order.spec_approved_at !== null &&        // ãƒ‡ãƒ¼ã‚¿æ‰¿èª
          order.contract_signed_at !== null         // å¥‘ç´„ç½²å
        );
      }
      ```

13. è£½é€ é–‹å§‹API
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/admin/orders/{id}/start-production/route.ts`ï¼ˆæ—¢å­˜ï¼‰
    - ä¿®æ­£äº‹é …:
      - `canStartProduction()`æ¡ä»¶æ¤œè¨¼è¿½åŠ 
      - æ¡ä»¶ä¸å……è¶³æ™‚ã‚¨ãƒ©ãƒ¼è¿”å´

#### Sprint 7: éŸ“å›½ç™ºæ³¨æ›¸ãƒ¡ãƒ¼ãƒ«é€ä»˜ï¼ˆ1æ—¥ï¼‰
14. ç™ºæ³¨æ›¸ä½œæˆåŠã³ãƒ¡ãƒ¼ãƒ«ç™ºä¿¡
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/admin/orders/{id}/send-purchase-order/route.ts`ï¼ˆæ–°è¦ï¼‰
    - æ©Ÿèƒ½:
      - ç™ºæ³¨æ›¸PDFä½œæˆ
      - ãƒ¡ãƒ¼ãƒ«ç™ºä¿¡ (info@epackage-lab.com â†’ info@epackage-lab.com)
    - ãƒ¡ãƒ¼ãƒ«å†…å®¹:
      ```email
      Subject: [ç™ºæ³¨] JP-{orderNumber} - {companyName}

      ç™ºæ³¨æ›¸ã‚’æ·»ä»˜ã—ã¾ã™ã€‚

      æ³¨æ–‡æƒ…å ±:
      - æ³¨æ–‡ç•ªå·: JP-2025-001
      - é¡§å®¢: {companyName}
      - è£½å“: {productDescription}
      - æ•°é‡: {quantity}
      - ç´æœŸ: {deliveryDate}

      æ·»ä»˜: purchase_order_{orderNumber}.pdf
      ```

#### Sprint 8: é€çŠ¶ç•ªå·åŠã³åˆ°ç€äºˆå®šå…¥åŠ›ï¼ˆ1æ—¥ï¼‰
15. ç®¡ç†è€…é…é€æƒ…å ±å…¥åŠ›ãƒšãƒ¼ã‚¸
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/admin/orders/{id}/shipping-info/page.tsx`ï¼ˆæ—¢å­˜æ´»ç”¨ï¼‰
    - æ©Ÿèƒ½:
      - é€çŠ¶ç•ªå·å…¥åŠ›
      - é…é€æ¥­è€…é¸æŠ (EMS, ãƒ¤ãƒãƒˆ, ä½å·, éƒµä¾¿)
      - åˆ°ç€äºˆå®šé¸æŠ
      - é…é€é–‹å§‹ãƒœã‚¿ãƒ³

16. é…é€æƒ…å ±ç™»éŒ²API
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/admin/orders/{id}/shipping-info/route.ts`ï¼ˆæ—¢å­˜æ´»ç”¨ï¼‰
    ```typescript
    await supabase
      .from('orders')
      .update({
        tracking_number_domestic: trackingNumber,
        shipping_method: carrier,
        estimated_delivery_at: estimatedDate,
        shipped_to_customer_at: new Date().toISOString(),
      })
      .eq('id', orderId);
    ```

#### Sprint 9: ç´å“æ›¸è‡ªå‹•ç™ºä¿¡ï¼ˆ1æ—¥ï¼‰
17. ç´å“æ›¸ä½œæˆåŠã³ãƒ¡ãƒ¼ãƒ«ç™ºä¿¡
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/admin/orders/{id}/delivery-note/route.ts`ï¼ˆæ—¢å­˜æ´»ç”¨ï¼‰
    - ç™ºä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°:
      - é…é€å®Œäº†æ™‚ (`orders.delivered_at`è¨­å®šæ™‚ç‚¹)
      - ã¾ãŸã¯ç®¡ç†è€…ãŒæ‰‹å‹•ã§ç™ºä¿¡ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯

18. é…é€å®Œäº†Webhookï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/webhooks/shipping/route.ts`ï¼ˆæ–°è¦ï¼‰
    - æ©Ÿèƒ½:
      - é…é€æ¥­è€…Webhookå—ä¿¡
      - `orders.delivered_at`è‡ªå‹•è¨­å®š
      - ç´å“æ›¸è‡ªå‹•ç™ºä¿¡ãƒˆãƒªã‚¬ãƒ¼

#### Sprint 10: 3ãƒ¶æœˆå¾Œè‡ªå‹•æ•´ç†ï¼ˆ1æ—¥ï¼‰
19. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼è¨­å®š
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/lib/cron/archive-completed-orders.ts`ï¼ˆæ–°è¦ï¼‰
    - æ©Ÿèƒ½:
      - æ¯æ—¥æ·±å¤œå®Ÿè¡Œ
      - `delivered_at`ãŒ3ãƒ¶æœˆä»¥ä¸Šå‰ã®æ³¨æ–‡æ¤œç´¢
      - `archived_at`ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è¨­å®š
      - é¡§å®¢ã¸ã€Œæ³¨æ–‡å®Œäº†3ãƒ¶æœˆçµŒéã€é€šçŸ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    - Vercel Cron Jobs:
      ```json
      {
        "crons": [
          {
            "path": "/api/cron/archive-orders",
            "schedule": "0 0 * * *"
          }
        ]
      }
      ```

20. ã‚¢ãƒ¼ã‚«ã‚¤ãƒ“ãƒ³ã‚°API
    - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/cron/archive-orders/route.ts`ï¼ˆæ–°è¦ï¼‰
    ```typescript
    // 3ãƒ¶æœˆä»¥å‰å®Œäº†æ³¨æ–‡ã‚¢ãƒ¼ã‚«ã‚¤ãƒ“ãƒ³ã‚°
    const threeMonthsAgo = new Date();
    threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);

    await supabase
      .from('orders')
      .update({ archived_at: new Date().toISOString() })
      .eq('status', 'DELIVERED')
      .lt('delivered_at', threeMonthsAgo.toISOString());
    ```

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒä¿®æ­£

### 3.1 ordersãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ ã‚«ãƒ©ãƒ 

```sql
-- å…¥é‡‘ç¢ºèª
ALTER TABLE orders ADD COLUMN payment_confirmed_at TIMESTAMP;
ALTER TABLE orders ADD COLUMN payment_amount DECIMAL(12, 2);

-- ã‚¢ãƒ¼ã‚«ã‚¤ãƒ“ãƒ³ã‚°
ALTER TABLE orders ADD COLUMN archived_at TIMESTAMP;

-- éŸ“å›½ç™ºæ³¨æ›¸
ALTER TABLE orders ADD COLUMN purchase_order_sent_at TIMESTAMP;
ALTER TABLE orders ADD COLUMN purchase_order_url TEXT;
```

### 3.2 design_revisionsãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—¢å­˜TASK.mdã«å®šç¾©æ¸ˆã¿ï¼‰

```sql
CREATE TABLE design_revisions (
  id UUID PRIMARY KEY,
  order_id UUID REFERENCES orders(id),
  revision_number INT NOT NULL,
  corrected_files JSONB,
  partner_comment TEXT,
  customer_comment TEXT,
  approval_status VARCHAR(20), -- pending / approved / rejected
  approved_by UUID REFERENCES users(id),
  approved_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

## 4. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

### 4.1 æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ admin/orders/[id]/
â”‚   â”‚   â”œâ”€â”€ correction-upload/page.tsx         # ä¿®æ­£ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ payment-confirmation/page.tsx      # å…¥é‡‘ç¢ºèª
â”‚   â”‚   â””â”€â”€ send-purchase-order/route.ts       # ç™ºæ³¨æ›¸ç™ºä¿¡
â”‚   â”œâ”€â”€ member/orders/[id]/
â”‚   â”‚   â”œâ”€â”€ data-upload/page.tsx               # ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆä¿®æ­£ï¼‰
â”‚   â”‚   â””â”€â”€ spec-approval/page.tsx             # ä»•æ§˜æ›¸æ‰¿èª
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ admin/orders/[id]/
â”‚       â”‚   â”œâ”€â”€ correction/route.ts            # ä¿®æ­£ãƒ‡ãƒ¼ã‚¿ä¿å­˜
â”‚       â”‚   â”œâ”€â”€ payment-confirmation/route.ts  # å…¥é‡‘ç¢ºèª
â”‚       â”‚   â””â”€â”€ send-purchase-order/route.ts   # ç™ºæ³¨æ›¸ç™ºä¿¡
â”‚       â”œâ”€â”€ member/orders/[id]/
â”‚       â”‚   â””â”€â”€ spec-approval/route.ts         # ä»•æ§˜æ›¸æ‰¿èª
â”‚       â”œâ”€â”€ cron/archive-orders/route.ts       # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ“ãƒ³ã‚°ã‚¯ãƒ­ãƒ³
â”‚       â””â”€â”€ webhooks/shipping/route.ts        # é…é€å®Œäº†ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯
â””â”€â”€ lib/
    â””â”€â”€ cron/archive-completed-orders.ts      # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ“ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
```

### 4.2 ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«

```
src/
â”œâ”€â”€ app/member/quotations/[id]/page.tsx        # æ³¨æ–‡ç¢ºå®šãƒœã‚¿ãƒ³ä¿®æ­£
â”œâ”€â”€ app/admin/orders/[id]/shipping-info/page.tsx  # é€çŠ¶ç•ªå·å…¥åŠ›ï¼ˆæ—¢å­˜ï¼‰
â”œâ”€â”€ lib/production-actions.ts                   # è£½é€ é–‹å§‹æ¡ä»¶è¿½åŠ 
â””â”€â”€ lib/email-templates.ts                      # ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¿½åŠ 
```

---

## 5. ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### 5.1 Stage 6: ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿é€ä»˜

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/lib/email-templates/stage6-design-data-submission.ts`

### 5.2 Stage 7: ä¿®æ­£ãƒ‡ãƒ¼ã‚¿å®Œäº†

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/lib/email-templates/stage7-correction-complete.ts`

### 5.3 Stage 10: ç™ºæ³¨æ›¸é€ä»˜

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/lib/email-templates/stage10-purchase-order.ts`

---

## 6. æˆåŠŸåŸºæº–

### 6.1 æ©Ÿèƒ½çš„è¦ä»¶
- [ ] è¦‹ç© â†’ æ³¨æ–‡å¤‰æ›æ­£å¸¸å‹•ä½œ
- [ ] ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ éŸ“å›½é€ä¿¡ãƒ¡ãƒ¼ãƒ«ç™ºä¿¡
- [ ] ä¿®æ­£ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ é¡§å®¢æ‰¿èªè¦æ±‚
- [ ] æ‰¿èª/å†è¦æ±‚ãƒ«ãƒ¼ãƒ—æ­£å¸¸å‹•ä½œ
- [ ] å…¥é‡‘ç¢ºèªæ©Ÿèƒ½
- [ ] å…¥é‡‘+ãƒ‡ãƒ¼ã‚¿æ‰¿èªå¾Œè£½é€ é–‹å§‹
- [ ] ç™ºæ³¨æ›¸ãƒ¡ãƒ¼ãƒ«ç™ºä¿¡
- [ ] é€çŠ¶ç•ªå·å…¥åŠ›åŠã³é…é€è¿½è·¡
- [ ] ç´å“æ›¸è‡ªå‹•ç™ºä¿¡
- [ ] 3ãƒ¶æœˆå¾Œè‡ªå‹•ã‚¢ãƒ¼ã‚«ã‚¤ãƒ“ãƒ³ã‚°

### 6.2 éæ©Ÿèƒ½çš„è¦ä»¶
- [ ] ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ—¥æœ¬èªãƒ“ã‚¸ãƒã‚¹æ¨™æº–æº–æº–æ‹ 
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™éµå®ˆ
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°åŠã³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- [ ] æ¨©é™ç¢ºèªï¼ˆä¼šå“¡/ç®¡ç†è€…ï¼‰
- [ ] é€²æ—ç‡å¯è¦–åŒ–

---

## 7. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/æ€§èƒ½æ”¹å–„ã‚¿ã‚¹ã‚¯ï¼ˆPRD2ã‚ˆã‚Šç¶™æ‰¿ï¼‰

### 7.1 P0: ç·Šæ€¥ï¼ˆ1é€±é–“ï¼‰

#### SEC-001: ç®¡ç†è€…ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆèªè¨¼è¿½åŠ 
- ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/dev/set-admin/route.ts`
- ç¾çŠ¶: èªè¨¼ãƒã‚§ãƒƒã‚¯ãªã—
- ä¿®æ­£: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªã€ç®¡ç†è€…æ¨©é™æ¤œè¨¼

#### SEC-002: innerHTML XSSè„†å¼±æ€§ä¿®æ­£
- ãƒ•ã‚¡ã‚¤ãƒ«: `src/lib/pdf-generator.ts` ä»–5ç®‡æ‰€
- ç¾çŠ¶: sanitizeãªã—
- ä¿®æ­£: DOMPurifyå°å…¥ã€è¨±å¯ã‚¿ã‚°æŒ‡å®š

#### CODE-001: Contextãƒã‚°ä¿®æ­£
- ãƒ•ã‚¡ã‚¤ãƒ«: `src/contexts/MultiQuantityQuoteContext.tsx:951`
- ç¾çŠ¶: stateãŒdepsã«ãªã„ã€å¤ã„ãƒ‡ãƒ¼ã‚¿å‚ç…§
- ä¿®æ­£: stateã‚’depsã«è¿½åŠ 

#### PERF-001: N+1ã‚¯ã‚¨ãƒªä¿®æ­£
- ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/b2b/quotations/route.ts:158-198`
- ç¾çŠ¶: 20å€‹è¦‹ç©ã§41å€‹ã‚¯ã‚¨ãƒª
- ä¿®æ­£: RPCé–¢æ•°ã¾ãŸã¯ãƒ“ãƒ¥ãƒ¼ä½¿ç”¨

#### CODE-004: è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
- ãƒ•ã‚¡ã‚¤ãƒ«: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
- ä¿®æ­£: 7å€‹è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 

### 7.2 P1: é«˜å„ªå…ˆåº¦ï¼ˆ2é€±é–“ï¼‰

#### SEC-003: ã‚µãƒ¼ãƒ“ã‚¹å½¹å‰²ã‚­ãƒ¼ä½¿ç”¨æ¤œè¨
- å¯¾è±¡: 30å€‹APIãƒ«ãƒ¼ãƒˆ
- ä¿®æ­£: APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£…

#### CODE-002: `as any`å‰Šé™¤
- å¯¾è±¡: 336å€‹ç™ºç”Ÿ
- ç›®æ¨™: 50å€‹ã¾ã§å‰Šæ¸›

#### CODE-003: `@ts-ignore`å‰Šé™¤
- å¯¾è±¡: 93å€‹ç™ºç”Ÿ
- ç›®æ¨™: 10å€‹ã¾ã§å‰Šæ¸›

---

**æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 5.0
**æœ€çµ‚æ›´æ–°**: 2026-01-30
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: Sprint 0å®Œäº†å¾Œ
