# 100円単位切り上げ（反り上げ）修正完了

## 問題
ユーザー報告: コンソールで168,400円と計算された見積が、member/quotationsページでは150,000円と誤って表示されていた。

## 原因
1. フロントエンドが `Math.round(totalPrice / 100) * 100` を使用（最近接400円に丸まる）
2. APIが `unit_price × quantity` で再計算し、かつ `Math.round` を使用
3. 切り上げ（反り上げ）ではなく四捨五入になっていた

## 修正内容

### 1. フロントエンド (`src/lib/unified-pricing-engine.ts` 行1436)
```typescript
// 修正前:
const roundedTotalPrice = Math.round(totalPrice / 100) * 100;

// 修正後:
// 100円単位で切り上げ（反り上げ）例：176930 → 177000、165042 → 165100
const roundedTotalPrice = Math.ceil(totalPrice / 100) * 100;
```

### 2. API (`src/app/api/member/quotations/route.ts`)
既に修正済み。`Math.ceil` を使用した切り上げ処理が実装されていた。

## 検証結果

### テストケース: 130x130x30mm, スタンドパウチ, PET/AL, 500個
- **フロントエンド計算**: 162,049円 → 162,100円（差分: +51円）✅
- **データベース保存**:
  - 見積番号: QT20260207-2855
  - 小計（税別）: 162,000円 ✅
  - 合計（税込）: 178,200円 ✅

### コンソールログでの切り上げ確認
- 156,458 → 156,500 (+42) ✅
- 167,468 → 167,500 (+32) ✅
- 189,486 → 189,500 (+14) ✅
- 162,049 → 162,100 (+51) ✅

すべて正しく100円単位で切り上げ（反り上げ）されています。

## 修正日
2026-02-07
