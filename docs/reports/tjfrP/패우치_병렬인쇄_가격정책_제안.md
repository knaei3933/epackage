# パウチ並列生産価格モデル（2列印刷対応）

> **作成日**: 2026-01-17
> **目的**: パウチ製品における2列印刷と並列生産の価格モデル設計

---

## 1. パウチとロールフィルムの違い

### 1-1. 生産方式の対比

| 項目 | ロールフィルム | パウチ |
|------|--------------|--------|
| **並列生産** | 複数ロールを同時にスリット | **2列印刷**が主流 |
| **価格提示単位** | 1本あたり | **1個あたり** |
| **数量設定** | ロール数 × 長さ | **SKU数 × 個数** |
| **お得感の提示** | 「3本で30% OFF」 | **「2列生産で単価半減」** |

### 1-2. パウチ特有の並列生産概念

```
【2列印刷とは？】

1列生産: 1列でパウチを製造
  ├─ フィルム幅: (H × 2) + 41
  └─ 1mあたり生産数: 1000 ÷ ピッチ

2列生産: 2列を同時に並列生産
  ├─ フィルム幅: (H × 4) + 71
  ├─ 1mあたり生産数: 2倍（2000 ÷ ピッチ）
  └─ コスト: 約50%削減
```

---

## 2. パウチ並列生産の3つのパターン

### 2-1. パターン分類

```
パウチ並列生産
│
├─ A. 同一デザインの大量生産（2列印刷）
│   └─ 1つのデザインを大量注文する場合
│       例: チョコ味 10,000個
│
├─ B. 複数SKUの並列生産（Multi-SKU）
│   └─ 異なるデザインを同時生産する場合
│       例: チョコ味 5,000個 + ストロベリー 5,000個
│
└─ C. 2列×複数SKUの組み合わせ
    └─ 2列生産で複数デザインを生産
        例: 2列生産 × (チョコ + ストロベリー) 各5,000個
```

---

## 3. パターンA: 同一デザインの大量生産（2列印刷）

### 3-1. 適用条件

**2列印刷可能条件**:
```
2列フィルム幅 ≤ 570mm（590mm原反）
または
2列フィルム幅 ≤ 740mm（760mm原反）
```

**各パウチタイプの2列フィルム幅計算**:

| パウチタイプ | 1列幅 | 2列幅 | 2列可能（Hの条件） |
|-------------|-------|-------|-------------------|
| 平袋 | H×2+41 | **H×4+71** | H ≤ 125（590原反） |
| スタンドアップ | H×2+G+35 | **H×4+G+40** | H ≤ 125（590原反） |

### 3-2. 価格モデル

```
1列生産単価 = 基準単価
2列生産単価 = 基準単価 × 0.6（40% OFF）
```

| 注文数量 | 生産方式 | 単価 | 割引率 |
|----------|----------|------|--------|
| 100-999個 | 1列 | 基準 | 0% |
| 1,000-4,999個 | 1列 | 基準 | 0% |
| 5,000個以上 | **2列** | **60%** | **40% OFF** ⭐ |

### 3-3. 実装アルゴリズム

```typescript
/**
 * 2列印刷可能判定
 */
function canUseTwoColumnProduction(
  pouchType: 'flat_3_side' | 'stand_up',
  dimensions: { height: number; depth?: number }
): TwoColumnAnalysis {
  const filmWidth2Col = pouchType === 'flat_3_side'
    ? (dimensions.height * 4) + 71
    : (dimensions.height * 4) + (dimensions.depth || 0) + 40;

  const canUse590 = filmWidth2Col <= 570;
  const canUse760 = filmWidth2Col <= 740;

  return {
    filmWidth2Column: filmWidth2Col,
    twoColumnAvailable: canUse590 || canUse760,
    recommendedMaterial: canUse760 ? 760 : (canUse590 ? 590 : null),
    efficiencyGain: 0.5  // 2列で50%コスト削減
  };
}

/**
 * 同一デザイン大量生産の価格提案
 */
function generateSingleDesignProposal(
  quantity: number,
  dimensions: PouchDimensions,
  pouchType: string
): PriceProposal {
  const twoColumnAnalysis = canUseTwoColumnProduction(pouchType, dimensions);
  const basePrice = calculateBasePrice(quantity, dimensions, pouchType);

  // 5,000個以上で2列生産推奨
  if (quantity >= 5000 && twoColumnAnalysis.twoColumnAvailable) {
    const twoColumnPrice = basePrice * 0.6;  // 40% OFF

    return {
      singleColumn: {
        quantity,
        unitPrice: basePrice / quantity,
        totalPrice: basePrice,
        method: '1列生産'
      },
      twoColumn: {
        quantity,
        unitPrice: twoColumnPrice / quantity,
        totalPrice: twoColumnPrice,
        method: '2列生産（推奨）',
        savings: basePrice - twoColumnPrice,
        savingsRate: 0.4,
        recommended: true
      },
      message: '5,000個以上で2列生産可能！40% OFF'
    };
  }

  return {
    singleColumn: {
      quantity,
      unitPrice: basePrice / quantity,
      totalPrice: basePrice,
      method: '1列生産'
    },
    twoColumn: null,
    message: twoColumnAnalysis.twoColumnAvailable
      ? '5,000個以上で2列生産お得'
      : 'このサイズは2列生産不可'
  };
}
```

### 3-4. UI表示例

```
┌─────────────────────────────────────────────────────────────┐
│  平袋 80mm × 120mm × 10,000個                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  💡 お得なご提案                                           │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ⭐ 推奨: 2列生産                                     │  │
│  │                                                      │  │
│  │  590mm原反で2列同時生産可能                         │  │
│  │  フィルム幅: 391mm < 570mm（2列対応）               │  │
│  │                                                      │  │
│  │  数量: 10,000個                                      │  │
│  │                                                      │  │
│  │  【1列生産】                                         │  │
│  │  単価: ¥50/個                                        │  │
│  │  合計: ¥500,000                                      │  │
│  │                                                      │  │
│  │  【2列生産】⭐ お得                                │  │
│  │  単価: ¥30/個（40% OFF）                            │  │
│  │  合計: ¥300,000                                      │  │
│  │  お得: -¥200,000                                      │  │
│  │                                                      │  │
│  │  [2列生産で見積もる] ボタン                          │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. パターンB: 複数SKUの並列生産（Multi-SKU）

### 4-1. 概念

```
複数SKU = 異なるデザインを同時生産

例: チョコ味 5,000個 + ストロベリー 5,000個
     = 総数 10,000個（2 SKU）

生産方式:
- 各SKUの理論メートル数を計算
- 最小確保量を適用（1 SKU: 500m、2+ SKU: 各300m）
- 2列印刷可能なら2列生産を適用
```

### 4-2. 価格モデル

```
基本価格 = Σ(各SKUの原価)

【数量割引】
総数に基づく割引を適用:
- 5,000-9,999個: 10% OFF
- 10,000-29,999個: 15% OFF
- 30,000個以上: 20% OFF

【SKUプレミアム】
複数SKUの場合の追加料金:
- 2-3 SKU: +5%
- 4-10 SKU: +10%
- 11+ SKU: +15%

【最終価格】
最終価格 = (基本価格 × (1 - 数量割引)) × (1 + SKUプレミアム)
```

### 4-3. 実装例

```typescript
/**
 * 複数SKUの価格計算
 */
function calculateMultiSKUPricing(
  skuQuantities: number[],
  dimensions: PouchDimensions,
  pouchType: string
): MultiSKUPricingResult {
  const totalQuantity = skuQuantities.reduce((sum, q) => sum + q, 0);
  const skuCount = skuQuantities.length;

  // 各SKUの原価計算
  const skuCosts = skuQuantities.map((qty, idx) =>
    calculateSingleSKUCost(idx, qty, skuCount, dimensions, pouchType)
  );

  const basePrice = skuCosts.reduce((sum, cost) => sum + cost.costJPY, 0);

  // 数量割引
  const quantityDiscount = getQuantityDiscountRate(totalQuantity);

  // SKUプレミアム
  const skuPremium = getSKUPremiumRate(skuCount);

  // 最終価格
  const finalPrice = basePrice * (1 - quantityDiscount) * (1 + skuPremium);

  return {
    totalQuantity,
    skuCount,
    basePrice,
    quantityDiscount,
    skuPremium,
    finalPrice,
    perUnitPrice: finalPrice / totalQuantity,
    skuBreakdown: skuCosts
  };
}
```

### 4-4. UI表示例

```
┌─────────────────────────────────────────────────────────────┐
│  2 SKU見積もり: 合計10,000個                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  SKU構成:                                                   │
│  • SKU 1（チョコ味）: 5,000個                              │
│  • SKU 2（ストロベリー）: 5,000個                          │
│                                                             │
│  価格内訳:                                                 │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  基本価格: ¥1,000,000                                │  │
│  │  数量割引（10,000個、15% OFF）: -¥150,000            │  │
│  │  SKUプレミアム（2 SKU、+5%）: +¥42,500               │  │
│  │  -----------------------------------------            │  │
│  │  最終価格: ¥892,500                                  │  │
│  │  単価: ¥89.25/個                                    │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  💡 さらに2列生産で40% OFF！                               │
│  [2列生産オプションを確認] ボタン                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 5. パターンC: 2列×複数SKUの組み合わせ

### 5-1. 最も効率的なパターン

```
条件:
- 2列印刷可能なサイズ
- 各SKUが5,000個以上

例: 2列生産 × 2 SKU × 各5,000個 = 総数10,000個

生産フロー:
列1: チョコ味 5,000個
列2: ストロベリー 5,000個
↓ 2列同時生産
フィルム使用量: 1列生産の約50%

価格効果:
- 2列生産割引: 40% OFF
- 数量割引: 15% OFF
- 総割引: 最大約55% OFF
```

### 5-2. 価格計算

```typescript
/**
 * 2列×複数SKUの最適価格計算
 */
function calculateTwoColumnMultiSKUPricing(
  skuQuantities: number[],
  dimensions: PouchDimensions,
  pouchType: string
): OptimalPricingProposal {
  const totalQuantity = skuQuantities.reduce((sum, q) => sum + q, 0);
  const skuCount = skuQuantities.length;

  // 2列生産可能判定
  const twoColumnAnalysis = canUseTwoColumnProduction(pouchType, dimensions);

  // 各SKUが最小数量（5,000個）以上か確認
  const allSKUsEligible = skuQuantities.every(qty => qty >= 5000);

  if (twoColumnAnalysis.twoColumnAvailable && allSKUsEligible) {
    // 2列生産適用
    const basePrice = calculateBasePriceForAllSKUs(skuQuantities, dimensions, pouchType);
    const twoColumnPrice = basePrice * 0.6;  // 40% OFF

    // 数量割引追加適用
    const quantityDiscount = getQuantityDiscountRate(totalQuantity);
    const finalPrice = twoColumnPrice * (1 - quantityDiscount);

    return {
      method: '2列生産 × 複数SKU',
      eligible: true,
      basePrice,
      twoColumnDiscount: 0.4,
      quantityDiscount,
      finalPrice,
      totalDiscount: 1 - (finalPrice / basePrice),
      message: `${skuCount} SKU × 合計${totalQuantity.toLocaleString()}個で最大${Math.round((1 - finalPrice/basePrice) * 100)}% OFF`
    };
  }

  // 通常の複数SKU計算へ
  return {
    method: '標準生産',
    eligible: false,
    message: twoColumnAnalysis.twoColumnAvailable
      ? '各SKUを5,000個以上で2列生産可能'
      : 'このサイズは2列生産不可'
  };
}
```

---

## 6. 各パウチタイプの2列対応可否

### 6-1. 平袋（3方シール）

```
2列フィルム幅 = (H × 4) + 71
```

| パウチ縦 (H) | 2列フィルム幅 | 590mm対応 | 760mm対応 | 最小数量（2列） |
|-------------|---------------|-----------|-----------|----------------|
| 60mm | 311mm | ○ | ○ | 5,000個以上 |
| 80mm | 391mm | ○ | ○ | 5,000個以上 |
| 100mm | 471mm | ○ | ○ | 5,000個以上 |
| 120mm | 551mm | ○ | ○ | 5,000個以上 |
| 125mm | 571mm | × | ○ | 760mm使用で5,000個以上 |
| 130mm | 591mm | × | ○ | 760mm使用で5,000個以上 |
| 150mm | 671mm | × | × | 2列不可 |

### 6-2. スタンドアップパウチ

```
2列フィルム幅 = (H × 4) + G + 40
```

| パウチ縦 (H) | マチ (G) | 2列フィルム幅 | 590mm対応 | 760mm対応 |
|-------------|----------|---------------|-----------|-----------|
| 60mm | 40mm | 320mm | ○ | ○ |
| 80mm | 50mm | 410mm | ○ | ○ |
| 100mm | 60mm | 500mm | ○ | ○ |
| 120mm | 70mm | 590mm | × | ○ |
| 130mm | 70mm | 630mm | × | ○ |

### 6-3. 合掌袋・ボックスパウチ

**これらは2列印刷不可**

| パウチタイプ | 理由 | 対応方法 |
|-------------|------|----------|
| 合掌袋（T-shape） | 展開図構造 | **複数ロール並列生産**で対応 |
| ボックス（M-shape） | 展開図構造 | **複数ロール並列生産**で対応 |

---

## 7. 最適価格提案ロジック

### 7-1. 決定木

```
パウチ見積もり開始
│
├─ パウチタイプ判定
│   ├─ 平袋・スタンドアップ → 2列印刷検討
│   └─ 合掌袋・ボックス → 複数ロール並列生産
│
├─ SKU数判定
│   ├─ 1 SKU → 同一デザイン大量生産モデル
│   └─ 複数 SKU → Multi-SKUモデル
│
├─ 各SKU数量判定
│   ├─ 全て5,000個以上 → 2列×複数SKU適用可能
│   └─ 5,000個未満あり → 標準生産
│
└─ 最適提案生成
    ├─ 2列生産提案（40% OFF）
    ├─ 数量割引提案（10-20% OFF）
    └─ 組み合わせ提案（最大55% OFF）
```

### 7-2. 提案生成関数

```typescript
/**
 * 最適価格提案を生成
 */
function generateOptimalProposal(
  quoteRequest: QuoteRequest
): PricingProposal[] {
  const proposals: PricingProposal[] = [];

  const { pouchType, dimensions, skuQuantities } = quoteRequest;
  const totalQuantity = skuQuantities.reduce((sum, q) => sum + q, 0);
  const skuCount = skuQuantities.length;

  // 提案1: 標準生産
  proposals.push({
    name: '標準生産',
    method: '1列生産',
    unitPrice: calculateStandardPrice(quoteRequest),
    discount: 0,
    applicable: true
  });

  // 提案2: 2列生産（平袋・スタンドアップのみ）
  if (pouchType === 'flat_3_side' || pouchType === 'stand_up') {
    const twoColumnAnalysis = canUseTwoColumnProduction(pouchType, dimensions);

    if (twoColumnAnalysis.twoColumnAvailable) {
      // 1 SKUで5,000個以上、または複数SKUで各5,000個以上
      const eligible = skuCount === 1
        ? skuQuantities[0] >= 5000
        : skuQuantities.every(q => q >= 5000);

      if (eligible) {
        proposals.push({
          name: '2列生産（推奨）',
          method: '2列生産',
          unitPrice: calculateStandardPrice(quoteRequest) * 0.6,
          discount: 0.4,
          applicable: true,
          recommended: true,
          message: '40% OFF'
        });
      }
    }
  }

  // 提案3: 合掌袋・ボックスの並列生産
  if (pouchType === 't_shape' || pouchType === 'm_shape') {
    const filmWidth = calculateFilmWidth(pouchType, dimensions, 1);

    // 590mm原反での並列数
    const maxParallel590 = Math.floor(550 / filmWidth);
    // 760mm原反での並列数
    const maxParallel760 = Math.floor(720 / filmWidth);

    const maxParallel = Math.max(maxParallel590, maxParallel760);

    if (maxParallel >= 2) {
      proposals.push({
        name: `${maxParallel}本並列生産（推奨）`,
        method: '複数ロール並列生産',
        unitPrice: calculateStandardPrice(quoteRequest) * (1 / maxParallel),
        discount: 1 - (1 / maxParallel),
        applicable: true,
        recommended: true,
        message: `590mm原反で${maxParallel}本同時生産`
      });
    }
  }

  // 提案4: 数量割引（全パウチタイプ共通）
  if (totalQuantity >= 5000) {
    proposals.push({
      name: '数量割引',
      method: '1列生産',
      unitPrice: calculateStandardPrice(quoteRequest),
      discount: getQuantityDiscountRate(totalQuantity),
      applicable: true,
      message: `総数${totalQuantity.toLocaleString()}個で${Math.round(getQuantityDiscountRate(totalQuantity) * 100)}% OFF`
    });
  }

  // 割引率順にソート
  return proposals.sort((a, b) => b.discount - a.discount);
}
```

---

## 8. UIデザイン

### 8-1. 見積もり結果画面

```
┌─────────────────────────────────────────────────────────────┐
│  お見積もり結果                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【ご注文内容】                                             │
│  パウチタイプ: 平袋（3方シール）                           │
│  サイズ: 80mm × 120mm                                      │
│                                                             │
│  SKU 1（チョコ味）: 5,000個                                │
│  SKU 2（ストロベリー）: 5,000個                            │
│  合計: 10,000個                                            │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  💡 お得なご提案                                           │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ⭐ 最もお得: 2列生産 × 2 SKU                        │  │
│  │                                                      │  │
│  │  2列同時生産で各SKUを5,000個製造                    │  │
│  │                                                      │  │
│  │  通常価格: ¥1,000,000                               │  │
│  │  2列生産割引（40% OFF）: -¥400,000                 │  │
│  │  数量割引（15% OFF）: -¥90,000                      │  │
│  │  -----------------------------------------            │  │
│  │  お得価格: ¥510,000                                 │  │
│  │  総割引: 49% OFF                                     │  │
│  │  単価: ¥51/個                                       │  │
│  │                                                      │  │
│  │  [この提案で注文する] ボタン                          │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  その他のオプション                                         │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  標準生産                                          │  │
│  │  価格: ¥1,000,000（単価¥100/個）                   │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 9. 実装要件

### 9-1. 新規モジュール

```typescript
// src/lib/pouch-parallel-pricing.ts

export interface TwoColumnAnalysis {
  filmWidth2Column: number;
  twoColumnAvailable: boolean;
  recommendedMaterial: 590 | 760 | null;
  efficiencyGain: number;  // 0.5 = 50%コスト削減
}

export interface MultiSKUProposal {
  method: '1列生産' | '2列生産' | '複数ロール並列生産';
  basePrice: number;
  discount: number;
  finalPrice: number;
  recommended: boolean;
  message: string;
  applicable: boolean;
}

export class PouchParallelPricing {
  /**
   * 2列生産可能判定
   */
  analyzeTwoColumnFeasibility(
    pouchType: string,
    dimensions: PouchDimensions
  ): TwoColumnAnalysis;

  /**
   * 最適価格提案を生成
   */
  generateOptimalProposal(
    quoteRequest: QuoteRequest
  ): MultiSKUProposal[];

  /**
   * 2列×複数SKUの価格計算
   */
  calculateTwoColumnMultiSKUPricing(
    skuQuantities: number[],
    dimensions: PouchDimensions,
    pouchType: string
  ): PricingResult;
}
```

### 9-2: コンポーネント

```typescript
// src/components/quote/PouchPricingProposal.tsx

interface PouchPricingProposalProps {
  proposals: MultiSKUProposal[];
  quoteRequest: QuoteRequest;
  onSelectProposal: (proposal: MultiSKUProposal) => void;
}

export function PouchPricingProposal({
  proposals,
  quoteRequest,
  onSelectProposal
}: PouchPricingProposalProps) {
  const recommended = proposals.find(p => p.recommended) || proposals[0];

  return (
    <div className="space-y-6">
      {/* 推奨提案 */}
      <RecommendedProposalCard proposal={recommended} onSelect={onSelectProposal} />

      {/* その他の提案 */}
      <AlternativeProposals
        proposals={proposals.filter(p => p !== recommended)}
        onSelect={onSelectProposal}
      />

      {/* 価格内訳 */}
      <PriceBreakdown proposal={recommended} quoteRequest={quoteRequest} />
    </div>
  );
}
```

---

## 10. テストケース

### 10-1. 2列生産判定テスト

```typescript
describe('2列生産判定', () => {
  test('平袋 80mm × 120mm: 2列可能', () => {
    const result = analyzeTwoColumnFeasibility('flat_3_side', { width: 80, height: 120 });
    expect(result.twoColumnAvailable).toBe(true);
    expect(result.filmWidth2Column).toBe(391);
  });

  test('平袋 150mm × 200mm: 2列不可', () => {
    const result = analyzeTwoColumnFeasibility('flat_3_side', { width: 150, height: 200 });
    expect(result.twoColumnAvailable).toBe(false);
    expect(result.filmWidth2Column).toBe(671);
  });
});
```

### 10-2: 価格計算テスト

```typescript
describe('2列生産価格計算', () => {
  test('1 SKU × 10,000個: 40% OFF', () => {
    const result = calculatePricing({
      pouchType: 'flat_3_side',
      dimensions: { width: 80, height: 120 },
      skuQuantities: [10000]
    });

    expect(result.finalPrice).toBeCloseTo(result.basePrice * 0.6, 2);
  });

  test('2 SKU × 各5,000個: 2列生産 + 数量割引', () => {
    const result = calculatePricing({
      pouchType: 'flat_3_side',
      dimensions: { width: 80, height: 120 },
      skuQuantities: [5000, 5000]
    });

    // 2列生産40% OFF + 数量割引15% = 49% OFF
    expect(result.finalPrice).toBeCloseTo(result.basePrice * 0.51, 2);
  });
});
```

---

## 11. まとめ

### 11-1. パウチ並列生産の3つのパターン

| パターン | 条件 | 割引 | 適用製品 |
|----------|------|------|----------|
| **A. 2列生産** | 1 SKU、5,000個以上 | 40% OFF | 平袋・スタンドアップ |
| **B. 複数SKU** | 総数5,000個以上 | 10-20% OFF | 全パウチタイプ |
| **C. 2列×複数SKU** | 各5,000個以上 | 最大49% OFF | 平袋・スタンドアップ |

### 11-2. 合掌袋・ボックスパウチの対応

| パターン | 条件 | 割引 | メカニズム |
|----------|------|------|----------|
| **複数ロール並列生産** | フィルム幅が小さい | 20-40% OFF | 複数ロールを同時にスリット |

### 11-3. 顧客へのメッセージ

```
平袋・スタンドアップ:
「5,000個以上で2列生産！40% OFF」
「複数デザインまとめて注文でさらに15% OFF」

合掌袋・ボックス:
「2本まとめ注文で20% OFF」
「3本まとめ注文で30% OFF」
```

---

**作成日**: 2026-01-17
**バージョン**: 1.0
