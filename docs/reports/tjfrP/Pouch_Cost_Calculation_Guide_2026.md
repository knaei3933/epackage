# パウチ原価計算ガイド (Pouch Cost Calculation Guide)

> **更新日**: 2026-01-16
> **対象**: パウチ製品・ロールフィルムの原価計算
> **基準**: `POUCH_FORMULAS.md` + `原価計算.md`

---

## 📋 目次 (Table of Contents)

1. [基本変数定義](#1-基本変数定義)
2. [フィルム幅計算公式](#2-フィルム幅計算公式)
3. [列数自動判定ロジック](#3-列数自動判定ロジック)
4. [原反選定と効率化](#4-原反選定と効率化)
5. [経済的生産数量提案](#5-経済的生産数量提案)
6. [原価計算フロー](#6-原価計算フロー)
7. [価格計算詳細](#7-価格計算詳細)
8. [実装ステータス](#8-実装ステータス)

---

## 1. 基本変数定義

### 変数一覧

| 変数 | 説明 | 単位 |
|------|------|------|
| **H** | パウチ縦（Height） | mm |
| **W** | パウチ横（Width）/ ピッチ（Pitch） | mm |
| **G** | マチまたは側面（Gusset） | mm |
| **Q** | 数量（Quantity） | 個 |

### 重要概念

| 概念 | 説明 |
|------|------|
| **ピッチ（Pitch）** | パウチの進行方向の幅。1mあたりの生産可能数を決定 |
| **フィルム幅** | 原反から切り出すフィルムの幅。パウチタイプと縦（H）で決定 |
| **原反幅** | 実際の原材料フィルムの幅（590mm or 760mm） |
| **印刷可能幅** | 原反幅から両端10mmずつ除外した有効幅 |

---

## 2. フィルム幅計算公式

### 2-1. 平袋（三封・Flat Pouch / 3-Side Seal）

**配向**: 横向きで印刷 → **縦Hがフィルム幅を決定**

| 列数 | 公式 | 詳細構成 |
|------|------|----------|
| 1列 | `(H × 2) + 41` | `10(余白) + 5 + H + 5 + 5 + H + 5 + 10 + 1(スリッター)` |
| 2列 | `(H × 4) + 71` | `10 + 5 + H + 5 + 10(ジッパー) + H + 5 + 5 + H + 5 + 10(ジッパー) + H + 5 + 10 + 1` |

**計算例**: H=120mm
- 1列: (120 × 2) + 41 = **281mm**
- 2列: (120 × 4) + 71 = **551mm**

---

### 2-2. スタンドアップパウチ（Stand-up Pouch）

**配向**: 横向きで印刷 → **縦Hがフィルム幅を決定**

| 列数 | 公式 | 詳細構成 |
|------|------|----------|
| 1列 | `(H × 2) + G + 35` | `1(スリッター) + 2 + G + 2 + 10(アイマーク) + 5 + H + 5 + 5 + H + 5` |
| 2列 | `(H × 4) + G + 40` | `1(スリッター) + 2 + G(70+70) + 2 + 10(アイマーク) + 3 + H + 3 ...` |

**計算例**: H=130mm, G=30mm
- 1列: (130 × 2) + 30 + 35 = **325mm**
- 2列: (130 × 4) + 30 + 40 = **590mm**

---

### 2-3. 合掌袋（T封・Center Seal / T-Shape）

**配向**: 展開図基準 → **横Wがフィルム幅を決定**

| 列数 | 公式 | 詳細構成 |
|------|------|----------|
| 1列 | `(W × 2) + 22` | `1(スリッター) + 10 + W/2 + W + W/2 + 10 + 1(補正)` |

> **注意**: 2列生産はなし。代わりにマルチロール並列生産で最適化

**計算例**: W=60mm
- 1列: (60 × 2) + 22 = **142mm**

---

### 2-4. ボックスパウチ（M封・Box / M-Shape）

**配向**: 展開図基準 → **横Wと側面Gがフィルム幅を決定**

| 列数 | 公式 | 詳細構成 |
|------|------|----------|
| 1列 | `(G + W) × 2 + 32` | `10(アイマーク) + 5 + G + W + G + W + 5 + 10 + 1(スリッター) + 1(補正)` |

> **注意**: 2列生産はなし。代わりにマルチロール並列生産で最適化

**計算例**: W=50mm, G=90mm
- 1列: (90 + 50) × 2 + 32 = **312mm**

---

### 2-5. ロールフィルム（Roll Film）

**配向**: 指定なし → **入力幅Wがそのままフィルム幅**

| 公式 | 説明 |
|------|------|
| `W` | 入力された幅がそのままフィルム幅 |

**計算例**: W=476mm
- フィルム幅 = **476mm**

---

## 3. 列数自動判定ロジック

### 3-1. 基本アルゴリズム

```
IF (2列必要フィルム幅 ≤ 740mm) THEN
  → 2列採用（760mm原反使用）
ELSE
  → 1列採用（適切な幅の原反使用）
END IF
```

### 3-2. 判定条件表

| パウチタイプ | サイズ | 1列フィルム幅 | 2列フィルム幅 | 判定結果 |
|-------------|--------|---------------|---------------|----------|
| 平袋 | H=100 | 241mm | 471mm | **2列採用** (471 < 740) |
| 平袋 | H=120 | 281mm | 551mm | **2列採用** (551 < 740) |
| 平袋 | H=160 | 361mm | 711mm | **2列採用** (711 < 740) |
| 平袋 | H=180 | 401mm | 791mm | **1列採用** (791 > 740) |
| スタンド | H=130, G=30 | 325mm | 590mm | **2列採用** (590 < 740) |
| スタンド | H=180, G=40 | 435mm | 760mm | **1列採用** (760 > 740) |

### 3-3. 2列採用時のメリット

| 項目 | 1列 | 2列 | 効果 |
|------|-----|-----|------|
| 必要メートル数 | X | X ÷ 2 | **半減** |
| 原反効率 | 40~60% | 80~96% | **大幅向上** |

> **結論**: 2列で生産可能な場合は**必ず2列**を採用する

---

## 4. 原反選定と効率化

### 4-1. 利用可能な原反

| 原反幅 | 印刷可能幅 | 説明 | 最小発注量 |
|--------|-----------|------|-----------|
| 590mm | 570mm | 標準的な小・中型パウチ用 | 500m |
| 760mm | 740mm | 大型パウチまたは2列印刷用 | 500m |

### 4-2. 原反選定フロー

```
パウチサイズ入力
   ↓
2列フィルム幅計算
   ↓
2列幅 ≤ 740mm?
   ├─ YES → 760mm原反×2列採用
   └─ NO  → 1列フィルム幅計算
              ↓
         1列幅 ≤ 570mm?
              ├─ YES → 590mm原反×1列採用
              └─ NO  → 760mm原反×1列採用
```

### 4-3. マルチロール並列生産（合掌・ボックス専用）

合掌袋（T封）とボックスパウチ（M封）は2列生産がありません。代わりに**マルチロール並列生産**で最適化します。

#### 最適化アルゴリズム

```
現在のフィルム幅 = 計算式に基づく1列幅
利用可能な原反 = [590mm, 760mm]

FOR EACH 原反幅 DO
  有効幅 = 原反幅 - 20mm（両端余白）
  並列本数 = FLOOR(有効幅 / 現在のフィルム幅)

  IF (並列本数 > 最高並列本数) THEN
    最高並列本数 = 並列本数
    最適原反幅 = 現在の原反幅
  END IF
END FOR

フィルム使用量削減率 = (並列本数 - 1) × 100%
```

#### 計算例

| パウチタイプ | サイズ | フィルム幅 | 最適原反 | 並列本数 | 効率改善 |
|-------------|--------|-----------|---------|---------|---------|
| 合掌袋 | W=60mm | 142mm | 590mm | 4本 | 75%削減 |
| 合掌袋 | W=100mm | 222mm | 760mm | 3本 | 67%削減 |
| ボックス | W=50, G=90 | 312mm | 760mm | 2本 | 50%削減 |

---

## 5. 経済的生産数量提案

### 5-1. 基本概念

**パウチのピッチ（幅W）**が進行方向の配置を決定します。

```
1mあたり生産可能数 = 1000mm ÷ ピッチ（W）
```

**例**: 120×180mmパウチ（ピッチ=120mm）
- 1mあたり生産可能数 = 1000 ÷ 120 = **8.33個/m**
- 500m rollで生産可能 = 500 × 8.33 = **4,166個**
- **問題**: 顧客が500個だけ注文しても、4,166個分のフィルム代を支払う必要がある

### 5-2. 経済的数量計算

```
最小発注量フィルム = 900m（500m確保分 + 400mロス）
経済的数量 = FLOOR(900m × 1mあたり生産可能数)
```

**例**: 120×180mmパウチ
- 経済的数量 = FLOOR(900 × 8.33) = **7,500個**
- 注文数量500個との差 = 7,000個（93.3%の無駄）

### 5-3. 推奨ロジック

| 無駄率 | 推奨数量 | 理由 |
|--------|---------|------|
| ≤ 10% | 経済的数量 | フィルム効率最大化 |
| 10~30% | 選択肢提示 | 経済的数量 or 注文数量 |
| > 30% | 注文数量 | 無駄を避けるため注文数量推奨 |

### 5-4. 計算例

#### ケース1: 平袋 120×180mm、注文500個

| 項目 | 値 |
|------|-----|
| ピッチ | 120mm |
| 1mあたり生産数 | 8.33個/m |
| 最小発注量 | 900m |
| 経済的数量 | 7,500個 |
| 無駄率 | 93.3% |
| **推奨** | **500個**（無駄が多すぎるため） |

#### ケース2: 平袋 100×120mm、注文10,000個

| 項目 | 値 |
|------|-----|
| ピッチ | 100mm |
| 1mあたり生産数 | 10.0個/m |
| 最小発注量 | 900m |
| 経済的数量 | 9,000個 |
| 無駄率 | -11.1%（注文超過） |
| **推奨** | **9,000個**（効率化） |

---

## 6. 原価計算フロー

### 6-1. 全体フロー

```
1. パウチサイズ決定 (W × H ± G)
   ↓
2. SKU数決定
   ↓
3. 列数自動判定 (2列可能なら2列採用)
   ↓
4. フィルム幅計算（パウチタイプ・列数に応じて）
   ↓
5. 原反選定（590mm または 760mm）
   ↓
6. 理論メートル数計算
   ↓
7. 確保量計算（SKU数に応じた最小量、50m単位切り上げ）
   ↓
8. ロス追加（400m固定）
   ↓
9. 材料原価計算（ウォン）
   ↓
10. 印刷費用計算（ウォン）
   ↓
11. 後加工費用計算（ウォン）
   ↓
12. 関税適用（5%）
   ↓
13. 配送料計算（29kg単位）
   ↓
14. 円貨換算（× 0.12）
   ↓
15. 1個当たり単価算出
```

### 6-2. 最小確保量ルール

| SKU数 | 各SKU最小確保量 | ロス（固定） | 総発注量（最小） |
|--------|-----------------|--------------|------------------|
| **1種類** | 500m | 400m | **900m** |
| **2種類** | 各300m | 400m | **1000m** |
| **3種類** | 各300m | 400m | **1300m** |
| **4種類** | 各300m | 400m | **1600m** |

### 6-3. 確保量決定関数

```
IF SKU数 = 1 THEN
  最小確保量 = 500m
ELSE
  最小確保量 = 300m
END IF

IF 理論メートル数 ≤ 最小確保量 THEN
  確保量 = 最小確保量
ELSE
  確保量 = CEILING(理論メートル数, 50m)
END IF

総発注量 = 確保量 + 400m（ロス固定）
```

---

## 7. 価格計算詳細

### 7-1. 材料原価計算

```
原反重量(g) = 厚み(μm) ÷ 1,000 × 幅(m) × メートル数 × 比重
原反価格(ウォン) = 原反重量(kg) × 単価(ウォン/kg)
```

#### 材料単価（韓国からの輸入価格）

| 材料 | kg当たり単価(ウォン) | 比重 |
|------|---------------------|------|
| AL | 7,800ウォン | 2.71 |
| NY | 5,400ウォン | 1.16 |
| LLDPE | 2,800ウォン | 0.92 |
| PET | 2,800ウォン | 1.40 |
| VMPET | 3,600ウォン | 1.40 |
| CPP | 2,700ウォン | 0.91 |

### 7-2. 印刷費用

```
印刷費用(ウォン) = フィルム幅(m) × 使用メートル数 × 475ウォン/m²
```

### 7-3. 後加工費用

#### ラミネート加工費

```
ラミネート費(ウォン) = フィルム幅(m) × 使用メートル数 × ラミ単価 × ラミ回数
```

| 条件 | 単価 |
|------|------|
| **AL素材あり** | 75ウォン/m |
| **AL素材なし** | 65ウォン/m |

```
ラミ回数 = 層数 - 1
```

#### スリッター加工費

```
スリッター費(ウォン) = MAX(30,000ウォン, 使用メートル数 × 10ウォン)
```

#### 製袋加工費

```
基本加工費(ウォン) = パウチ横幅(cm) × 単価(ウォン/cm) × 数量
製袋加工費(ウォン) = MAX(基本加工費, 最小単価)
```

| パウチタイプ | 単価(ウォン/cm) | 最小単価（ウォン） |
|--------------|-----------------|-------------------|
| 平袋（三封） | 0.4ウォン | 200,000ウォン |
| 合掌袋（T封） | 1.2ウォン | 440,000ウォン |
| スタンドアップ | 1.2ウォン | 250,000ウォン |
| ジッパー袋 | 1.2ウォン | 250,000ウォン |
| ジッパー付きスタンド | 1.7ウォン | 280,000ウォン |
| ボックスパウチ（M封） | 1.2ウォン | 440,000ウォン |

### 7-4. 関税と配送料

#### 関税

```
関税込み価格(ウォン) = (材料原価 + 印刷費 + 後加工費) × 1.05
```

#### 配送料

| 種別(kg) | 配送料（ウォン） |
|----------|-----------------|
| 5.0 | 46,440ウォン |
| 10.0 | 64,800ウォン |
| 15.0 | 82,620ウォン |
| 20.0 | 98,820ウォン |
| 25.0 | 115,020ウォン |
| 29.0（1箱最大） | 127,980ウォン |

```
配送箱数 = CEILING(総重量 ÷ 29kg/箱)
配送料(ウォン) = 配送箱数 × 127,980ウォン/箱
```

### 7-5. 円貨換算

```
最終価格(円) = 円貨換算前価格(ウォン) × 0.12
1個当たり単価(円) = 最終価格(円) ÷ 数量
```

> **0.12 = 為替レート（1円 = 約8.33ウォン）**

---

## 8. 並列生産割引ポリシー (Parallel Production Discount Policy)

> **更新日**: 2026-01-18
> **目的**: 並列生産（2列以上）によるフィルム原価節減を顧客に還元

### 8-1. 割引基本ルール

並列生産により**フィルム使用量が削減**されるため、その節減分を割引として適用します。

| 並列数 | 割引適用 | 価格計算式 | 割引率 | 例（1本20万円） |
|--------|----------|-----------|--------|----------------|
| **1本（1列）** | 基準価格 | `価格 × 1` | 基準 | 20万円 |
| **2本（2列）** | 追加1本に40%OFF | `価格 × 1.6` | **40%OFF** | 32万円 |
| **3本（3列）** | 追加2本に70%OFF | `価格 × 1.9` | **70%OFF** | 38万円 |
| **4本（4列+）** | 追加3本+に70%OFF | `価格 × 2.2` | **70%OFF** | 44万円（4本） |

### 8-2. 割引計算式

```
並列生産価格 = 基準価格 × [1 + (追加並列数 × 割引係数)]

割引係数:
  - 2本目（2列目）: 0.6（40%割引）
  - 3本目以降（3列以降）: 0.3（70%割引）

計算例:
  2本: 基準価格 × (1 + 0.6) = 基準価格 × 1.6
  3本: 基準価格 × (1 + 0.3 + 0.3) = 基準価格 × 1.6
  4本: 基準価格 × (1 + 0.3 + 0.3 + 0.3) = 基準価格 × 2.0
  n本: 基準価格 × (1 + 0.3 × (n-1)) ※ n≧3
```

### 8-3. 重要事項

#### 8-3-1. 割引適用範囲

| 適用対象 | 適用内容 | 備考 |
|----------|----------|------|
| **フィルム原価** | ✅ 割引適用 | 並列生産でフィルム使用量が削減されるため |
| **パウチ加工費** | ❌ 割引なし | 加工費はパウチ数に比例して発生 |
| **印刷費** | ✅ 割引適用 | フィルム使用量に比例 |
| **ラミネート費** | ✅ 割引適用 | フィルム使用量に比例 |
| **スリッター費** | ❌ 割引なし | 固定費用 |
| **配送料** | ❌ 割引なし | 並列本数分の配送が必要 |

> **結論**: 割引は「フィルム原価+印刷費+ラミネート費」に対してのみ適用され、「パウチ加工費+スリッター費+配送料」は並列数分全額請求

#### 8-3-2. 適用製品タイプ

| 製品タイプ | 並列生産 | 最大並列数 | 割引適用 |
|-----------|----------|------------|----------|
| **ロールフィルム** | 本数並列 | 3-6本（幅による） | ✅ |
| **平袋（3方）** | 列並列 | 2列（760mm原反） | ✅ |
| **スタンドアップ** | 列並列 | 2列（760mm原反） | ✅ |
| **合掌袋（T封）** | 本数並列 | 3-4本（760mm原反） | ✅ |
| **ボックスパウチ（M封）** | 本数並列 | 2本（760mm原反） | ✅ |

### 8-4. 計算例

#### 8-4-1. ロールフィルム 200mm × 500m の場合

| 並列数 | 1本あたり価格 | 総価格 | 1mあたり単価 | 割引額 |
|--------|--------------|--------|-------------|--------|
| 1本 | 60,315円 | 60,315円 | 121円/m | - |
| 2本 | 38,558円 | 77,115円 | 77円/m | **24,105円**（40%OFF） |
| 3本 | 31,667円 | 95,000円 | 63円/m | **50,815円**（70%OFF） |

> **メモ**: 3本並列時の割引額 = 60,315円 × 3 - 95,000円 = **85,945円節減**

#### 8-4-2. 平袋 80mm × 120mm × 10,000個 の場合

| 生産方式 | 1列 | 2列並列 |
|----------|-----|---------|
| **フィルム使用量** | 1,550m | 1,000m（35%節減） |
| **フィルム原価（割引適用前）** | 250,000円 | 161,290円 |
| **割引適用後価格** | 250,000円 | **150,000円** |
| **1個あたり単価** | 25円/個 | **15円/個** |
| **割引率** | - | **40%OFF** |

> **メモ**: 2列並列でフィルム原価が35%節減され、40%割引価格で提供

### 8-5. 顧客への提示メッセージ

```
💡 並列生産でコスト節減！

ロールフィルム: 3本注文時 50%以上節減
パウチ製品: 2列生産で 40%割引（大容量注文時）

並列生産はフィルム使用量を大幅に削減し、
その節減分を割引としてお客様に還元します。
```

### 8-6. 実装ロジック

```typescript
/**
 * 並列生産割引計算
 * @param basePrice 基準価格（フィルム原価+印刷費+ラミネート費）
 * @param parallelCount 並列数（1=単独生産、2=2列/2本、3=3列/3本...）
 * @returns 割引適用後価格
 */
function calculateParallelDiscount(
  basePrice: number,
  parallelCount: number
): number {
  if (parallelCount <= 1) return basePrice;

  // 2本目（2列目）: 40%割引 = 60%価格
  // 3本目以降: 70%割引 = 30%価格
  let discountMultiplier = 1; // 1本目は100%

  if (parallelCount >= 2) {
    discountMultiplier += 0.6; // 2本目は60%
  }

  if (parallelCount >= 3) {
    discountMultiplier += 0.3 * (parallelCount - 2); // 3本目以降は各30%
  }

  return basePrice * discountMultiplier;
}
```

---

## 9. 実装ステータス

### 9-1. 実装完了項目

| 機能 | ステータス | ファイル |
|------|----------|----------|
| フィルム幅自動計算 | ✅ | `pouch-cost-calculator.ts` |
| 2列自動判定 | ✅ | `pouch-cost-calculator.ts` |
| 原反幅自動選定 | ✅ | `pouch-cost-calculator.ts` |
| SKU別原価計算 | ✅ | `pouch-cost-calculator.ts` |
| マルチロール最適化 | ✅ | `pouch-cost-calculator.ts` |
| 経済的数量提案 | ✅ | `pouch-cost-calculator.ts` |
| 統合価格計算エンジン | ✅ | `unified-pricing-engine.ts` |

### 9-2. 検証済みシナリオ

| シナリオ | フィルム幅 | 原反 | 検証結果 |
|---------|-----------|------|----------|
| SCENARIO-1-1: 平袋 100×120mm (2列) | 551mm | 590mm | ✅ |
| SCENARIO-1-2: 平袋 180×180mm (1列) | 401mm | 590mm | ✅ |
| SCENARIO-1-3: 平袋 160×160mm (2列) | 711mm | 760mm | ✅ |
| SCENARIO-2-1: スタンド 130×130mm (2列) | 590mm | 760mm | ✅ |
| SCENARIO-3-1: 合掌 60×100mm (1列) | 142mm | 590mm | ✅ |
| SCENARIO-4-1: ボックス 50×90mm (1列) | 312mm | 590mm | ✅ |
| SCENARIO-6-1: 2SKU 各500個 (2列) | 551mm | 590mm | ✅ |
| SCENARIO-PD-1: 並列生産割引 2本 | - | - | 🔄 実装予定 |
| SCENARIO-PD-2: 並列生産割引 3本 | - | - | 🔄 実装予定 |

**検証結果**: 🎉 **基本シナリオ検証通過** (7/7) | 🔄 **並列生産割引: 実装中**

### 9-3. テストスクリプト

| スクリプト | 説明 |
|-----------|------|
| `scripts/test-pricing-scenarios.ts` | 7種類の価格計算シナリオ検証 |
| `scripts/test-economic-quantity.ts` | 経済的数量提案機能検証 |
| `scripts/test-pricing-fixes.ts` | 修正内容検証 |

---

## まとめ (Summary)

### 重要ポイント

1. **フィルム幅決定**: 平袋・スタンドは**縦H**、合掌・ボックスは**横W**
2. **2列自動採用**: 2列可能なら必ず2列使用（効率化）
3. **原反選定**: 590mm or 760mm（フィルム幅に基づき自動選定）
4. **ロス固定**: 400m（SKU数・数量に関わらず一定）
5. **最小確保量**: 1SKU=500m、2+SKU=各300m
6. **マルチロール最適化**: 合掌・ボックスは並列生産で効率化
7. **経済的数量提案**: ピッチに基づき最適数量を自動提案
8. **🆕 並列生産割引**: 2本目は40%OFF、3本目以降は70%OFF（フィルム原価のみ）

### 並列生産割引まとめ

| 並列数 | 割引ルール | 計算式 | 例 |
|--------|----------|--------|-----|
| 1本 | 基準価格 | `価格 × 1` | 20万円 |
| 2本 | 追加1本に40%OFF | `価格 × 1.6` | 32万円 |
| 3本 | 追加2本に70%OFF | `価格 × 1.6` | 32万円 |
| 4本+ | 追加3本+に70%OFF | `価格 × (1 + 0.3×n)` | 44万円（4本） |

> **重要**: 割引は「フィルム原価+印刷費+ラミネート費」のみに適用。「パウチ加工費+スリッター費+配送料」は並列数分全額請求

### 最終計算式

```
// 基本価格計算（並列生産なし）
最終価格(円) = ((材料原価 + 印刷費 + 後加工費) × 1.05 + 配送料) × 0.12

// 並列生産割引適用後価格
並列生産価格 = 割引適用価格(フィルム+印刷+ラミ) + 全額請求費用(加工+スリッタ+配送)

// 割引適用価格 = 基準価格 × [1 + (追加並列数 × 割引係数)]
//   - 2本目: 割引係数 0.6（40%OFF）
//   - 3本目以降: 割引係数 0.3（70%OFF）
```

---

**作成日**: 2026-01-16
**更新日**: 2026-01-18（並列生産割引追加）
**バージョン**: 1.1
**関連ドキュメント**:
- `docs/reports/tjfrP/old/POUCH_FORMULAS.md`
- `docs/reports/tjfrP/old/原価計算.md`
