# 병렬 생산 가격 정책 구현 로드맵

> **작성일**: 2026-01-17
> **목적**: 가격 정책 분석 후 실제 시스템 적용을 위한 구체적인 로드맵 정의

---

## 1. 개요

### 1-1. 분석 완료된 문서들

| 문서 | 목적 | 상태 |
|------|------|------|
| `병렬인쇄_가격정책_통합제안.md` | 통합 제안 | 완료 |
| `20%마진기반_가격모델.md` | 마진 구조 분석 | 완료 |
| `각제품별_1열2열_비교분석.md` | 1열/2열 비교 | 완료 |
| `각제품별_가격계산_예시.md` | 가격 계산 예시 | 완료 |
| `각제품별_병렬인쇄_가격매트릭스.md` | 제품별 매트릭스 | 완료 |
| `체계적_병렬인쇄_가격모델_완전.md` | 완전 가격 모델 | 완료 |

### 1-2. 결론

```
【핵심 발견】

1. 2열 생산이 항상 유리한 것은 아님
   - 10,000개 단일 주문: 1열 생산이 더 저렴한 경우 존재
   - 20,000개 이상 대량 주문: 2열 생산이 유리해짐

2. 롤 필름의 병렬 생산은 명확히 유리
   - 2-3본 주문 시 20-30% 할인 제공 가능
   - 원반 폭에 따라 효율이 다름

3. 합장박스/박스파우치의 병렬 생산
   - 2-3개 병렬 주문 시 20-35% 할인 제공 가능
   - 필름 폭이 작을수록 병렬 생산 효율이 높음
```

---

## 2. 적용 우선순위

### 2-1. Phase 1: 롤 필름 병렬 생산 (최우선)

**이유**: 구현이 간단하고, 고객에게 명확한 혜택 제공

| 항목 | 내용 | 우선순위 |
|------|------|----------|
| UI 업데이트 | 롤 필름 견적 시스템에 병렬 생산 옵션 표시 | 🔥 높음 |
| 백엔드 로직 | 병렬 수에 따른 가격 계산 | 🔥 높음 |
| API 수정 | 가격 계산 API에 병렬 생산 로직 추가 | 🔥 높음 |
| 테스트 | 롤 필름 병렬 생산 테스트 �이스 작성 | 🔥 높음 |

**목표**: 2주 내 완료

### 2-2. Phase 2: 평Bag/스탠드업 2열 생산

**이유**: 대량 주문 고객에게 명확한 혜택 제공

| 항목 | 내용 | 우선순위 |
|------|------|----------|
| UI 업데이트 | 2열 생산 가능 여부 자동 판정 | ⚡ 중간 |
| 백엔드 로직 | 2열 생산시 원가 계산 | ⚡ 중간 |
| 가이드라인 | 2열 생산 추천 조건 정의 | ⚡ 중간 |
| 테스트 | 2열 생산 테스트 케이스 작성 | ⚡ 중간 |

**목표**: 3주 내 완료

### 2-3. Phase 3: 합장박스/박스파우치 병렬 생산

| 항목 | 내용 | 우선순위 | |
|------|------|----------|----------|
| UI 업데이트 | 병렬 수 선택 UI 추가 | 💤 낮음 |
| 백엔드 로직 | 2-3개 병렬 생산 가격 계산 | 💤 낮음 |
| 테스트 | 병렬 생산 테스트 케이스 작성 | 💤 낮음 |

**목표**: 4주 내 완료

---

## 3. Phase 1: 롤 필름 병렬 생산 구현 (상세)

### 3-1. UI 변경사항

**변경 전**:
```
롤 필름 200mm × 500m
수량: [500]m

총액: ¥100,000
```

**변경 후**:
```
롤 필름 200mm × 500m

💡 お得なご提案

• 1本注文: ¥100,000（1本あたり¥100,000）
• 2本注文: ¥160,000（1本あたり¥80,000、20% OFF）
• 3本注文: ¥210,000（1本あたり¥70,000、30% OFF）⭐推奨

フィルム効率: 83%
お得額: -¥90,000（30% OFF）

[3本セットで見積もる] ボタン
```

### 3-2. 백엔드 로직 변경

**변경해야 할 파일**:

```typescript
// src/lib/roll-film-pricing.ts (신규)
export function calculateRollFilmParallelPricing(
  filmWidthMM: number,
  requestedLength: number,
  orderCount: number
): RollFilmPricingResult {
  // 1. 최대 병렬 수 계산
  const maxParallel590 = Math.floor(550 / filmWidthMM);
  const maxParallel760 = Math.floor(720 / filmWidthMM);

  // 2. 효율 계산
  const efficiency590 = (filmWidthMM * orderCount) / 550 * 100;
  const efficiency760 = (filmWidthMM * orderCount) / 720 * 100;

  // 3. 할인율 결정
  const discount = determineDiscountRate(efficiency760, orderCount);

  // 4. 가격 계산
  const basePrice = calculateBasePrice(requestedLength);
  const discountedPrice = basePrice * (1 - discount) * orderCount;

  return {
    originalPrice: basePrice * orderCount,
    discountedPrice,
    discount,
    efficiency: efficiency760,
    recommendedOrderCount
  };
}

// src/components/quote/RollFilmPricingProposal.tsx (신규)
export function RollFilmPricingProposal({
  filmWidth,
  requestedLength
}: Props) {
  const proposals = generateParallelProductionOptions(filmWidth, requestedLength);

  return (
    <div className="space-y-6">
      <RecommendedProposalCard proposal={proposals[0]} />
      <AlternativeProposals proposals={proposals.slice(1)} />
    </div>
  );
}
```

### 3-3. API 변경사항

**변경해야 할 API 엔드포인트**:

```typescript
// src/app/api/quote/roll-film-options/route.ts (신규)
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const filmWidth = Number(searchParams.get('width'));
  const requestedLength = Number(searchParams.get('length'));

  const options = generateRollFilmParallelOptions(filmWidth, requestedLength);

  return NextResponse.json(options);
}
```

---

## 4. Phase 2: 평Bag/스탠드업 2열 생산 구현 (상세)

### 4-1. 2열 생산 자동 판정 로직

```typescript
// src/lib/two-column-analyzer.ts (신규)
export interface TwoColumnAnalysis {
  available: boolean;
  materialWidth: 590 | 760;
  efficiency: number;
  recommendedQuantity: number;
  discount: number;
}

export function analyzeTwoColumnFeasibility(
  pouchType: 'flat_3_side' | 'stand_up',
  dimensions: PouchDimensions,
  quantity: number
): TwoColumnAnalysis {
  // 1. 2열 필름 폭 계산
  const filmWidth2Column = calculateFilmWidth(pouchType, dimensions, 2);

  // 2. 590mm 원반으로 가능한지 확인
  const canUse590 = filmWidth2Column <= 550;
  const canUse760 = filmWidth2Column <= 720;

  // 3. 최소 수량 확인 (5,000개 이상)
  if (quantity < 5000) {
    return {
      available: false,
      materialWidth: 590,
      efficiency: 0,
      recommendedQuantity: 0,
      discount: 0
    };
  }

  // 4. 최적 원반 선택
  if (canUse760) {
    const efficiency = (filmWidth2Column / 720) * 100;
    if (efficiency >= 0.75) {
      return {
        available: true,
        materialWidth: 760,
        efficiency,
        recommendedQuantity: quantity,
        discount: efficiency >= 0.90 ? 0.40 : 0.30
      };
    }
  }

  if (canUse590) {
    const efficiency = (filmWidth2Column / 550) * 100;
    if (efficiency >= 0.70) {
      return {
        available: true,
        materialWidth: 590,
        efficiency,
        recommendedQuantity: quantity,
        discount: efficiency >= 0.90 ? 0.40 : 0.30
      };
    }
  }

  return {
    available: false,
    materialWidth: 590,
    efficiency: 0,
    recommendedQuantity: 0,
    discount: 0
  };
}
```

### 4-2. UI 변경사항

**변경 후 UI**:
```
평Bag 80mm × 120mm × 10,000개

💡 お得なご提案

【2列生産可能】
590mm原反でフィルム効率100%！

• 1列生産: ¥158,270（単価¥15.83/個）
• 2列生産: ¥110,315（単価¥11.03/個）

お得額: -¥47,955（30% OFF）

※ 5,000個未満の場合、1列生産がおすすめです
```

---

## 5. Phase 3: 합장박스/박스파우치 병렬 생산 구현

### 5-1. 병렬 생산 옵션 생성 로직

```typescript
// src/lib/parallel-production-options.ts (신규)
export interface ParallelProductionOption {
  orderCount: number;
  materialWidth: 590 | 760;
  discount: number;
  totalPrice: number;
  perUnitPrice: number;
  efficiency: number;
  recommended: boolean;
}

export function generateParallelProductionOptions(
  pouchType: 't_shape' | 'm_shape' | 'box',
  dimensions: PouchDimensions,
  requestedQuantity: number
): ParallelProductionOption[] {
  const filmWidth = calculateFilmWidth(pouchType, dimensions, 1);

  const options: ParallelProductionOption[] = [];

  // 590mm 원반 옵션
  const maxParallel590 = Math.floor(550 / filmWidth);
  if (maxParallel590 >= 2) {
    const discount = maxParallel590 >= 3 ? 0.30 : 0.20;
    options.push({
      orderCount: maxParallel590,
      materialWidth: 590,
      discount,
      totalPrice: calculatePrice(maxParallel590, discount),
      perUnitPrice: 0,
      efficiency: (filmWidth * maxParallel590) / 550 * 100,
      recommended: maxParallel590 >= 3
    });
  }

  // 760mm 원반 옵션
  const maxParallel760 = Math.floor(720 / filmWidth);
  if (maxParallel760 > maxParallel590 && maxParallel760 >= 2) {
    const discount = maxParallel760 >= 3 ? 0.30 : 0.20;
    options.push({
      orderCount: maxParallel760,
      materialWidth: 760,
      discount,
      totalPrice: calculatePrice(maxParallel760, discount),
      perUnitPrice: 0,
      efficiency: (filmWidth * maxParallel760) / 720 * 100,
      recommended: true
    });
  }

  return options.sort((a, b) => b.efficiency - a.efficiency);
}
```

---

## 6. 테스트 전략

### 6-1. 단위 테스트

```typescript
// __tests__/roll-film-pricing.test.ts
describe('Roll Film Parallel Production', () => {
  test('200mm × 500m should recommend 3-roll order', () => {
    const result = calculateRollFilmParallelPricing(200, 500, 3);
    expect(result.discount).toBeCloseTo(0.30, 2);
    expect(result.efficiency).toBeCloseTo(0.83, 2);
  });

  test('should apply 40% OFF when efficiency >= 90%', () => {
    const result = calculateRollFilmParallelPricing(100, 500, 6);
    expect(result.discount).toBeCloseTo(0.40, 2);
  });
});

// __tests__/two-column-analyzer.test.ts
describe('Two Column Production Analyzer', () => {
  test('80mm × 120mm × 10,000 should recommend 1-row', () => {
    const result = analyzeTwoColumnFeasibility('flat_3_side',
      { width: 80, height: 120 }, 10000);
    expect(result.available).toBe(false);
  });

  test('should recommend 2-row for 20,000 units', () => {
    const result = analyzeTwoColumnFeasibility('flat_3_side',
      { width: 80, height: 120 }, 20000);
    expect(result.available).toBe(true);
    expect(result.discount).toBeCloseTo(0.40, 2);
  });
});
```

---

## 7. 기술 구현 가이드

### 7-1. 효율 기반 할인율 결정 테이블

| 효율 범위 | 할인율 | 적용 조건 |
|----------|--------|----------|
| 90% 이상 | 40% OFF | 필름 폭 활용도 최우 |
| 80-89% | 30-35% OFF | 필름 폭 활용도 우수 |
| 70-79% | 20% OFF | 필름 폭 활용도 보통 |
| 60-69% | 15% OFF | 필름 폭 활용도 낮음 |
| 60% 미만 | 할인 없음 | 병렬 생산 비추천 |

### 7-2. 각 Phase 별 완료 기준

**Phase 1: 롤 필름 병렬 생산**
- [ ] 백엔드 로직 구현 완료
- [ ] UI 컴포넌트 구현 완료
- [ ] API 엔드포인트 구현 완료
- [ ] 테스트 케이스 작성 완료
- [ ] E2E 테스트 통과

**Phase 2: 평Bag/스탠드업 2열 생산**
- [ ] 2열 생산 분석 로직 구현 완료
- [ ] UI 제안 메시지 구현 완료
- [ ] 테스트 케이스 작성 완료
- [ ] E2E 테스트 통과

**Phase 3: 합장박스/박스파우치 병렬 생산**
- [ ] 병렬 생산 옵션 로직 구현 완료
- [ ] UI 컴포넌트 구현 완료
- [ ] 테스트 케이스 작성 완료
- [ ] E2E 테스트 통과

---

## 8. 변경 사항 요약

### 8-1. 새로 추가해야 할 파일

```
src/lib/
├── roll-film-pricing.ts (신규)         # 롤 필름 병렬 생산 가격 계산
├── two-column-analyzer.ts (신규)        # 2열 생산 가능성 분석
└── parallel-production-options.ts (신규) # 병렬 생산 옵션 생성

src/components/quote/
├── RollFilmPricingProposal.tsx (신규)   # 롤 필름 가격 제안 UI
├── TwoColumnProductionProposal.tsx (신규) # 2열 생산 가격 제안 UI
└── ParallelProductionOptions.tsx (신규)  # 병렬 생산 옵션 선택 UI

src/app/api/
├── quote/roll-film-options/route.ts (신규) # 롤 필름 옵션 조회 API
└── quote/two-column-analysis/route.ts (신규) # 2열 생산 분석 API
```

### 8-2. 수정해야 할 파일

```
src/lib/
├── pouch-cost-calculator.ts              # 2열 생산 로직 개선
└── unified-pricing-engine.ts             # 병렬 생산 옵션 추가

src/components/quote/
├── UnifiedSKUQuantityStep.tsx           # 제안 메시지 추가
└── QuoteWizard.tsx                      # 제안 스텝 추가

src/contexts/
└── QuoteContext.tsx                      # 병렬 생산 상태 추가
```

---

## 9. 다음 단계

### 9-1. 즉시 시작 가능한 작업

1. **롤 필름 병렬 생산 UI/UX 설계** - 30분 소요
2. **병렬 생산 할인율 테이블 최종 확정** - 15분 소요
3. **API 엔드포인트 명세 정의** - 30분 소요

### 9-2. 1주일 내 완료 가능한 작업

1. **롤 필름 병렬 생산 백엔드 로직 구현**
2. **롤 필름 가격 제안 UI 컴포넌트 구현**
3. **단위 테스트 케이스 작성**

---

**작성일**: 2026-01-17
**버전**: 1.0
**상태**: 구현 준비 단계
