# 体系的並列生産価格モデル（完全版）

> **作成日**: 2026-01-17
> **目的**: フィルム幅全範囲を網羅した体系的な並列生産価格モデル

---

## 1. 分析フレームワーク

### 1-1. 原反選定ロジック

```
原反選定の3つの基準:

1. フィルム幅が570mm以下 → 590mm原反
2. フィルム幅が570mm超740mm以下 → 760mm原反
3. フィルム幅が740mm超 → 特別対応または2分割生産
```

### 1-2. 並列生産効率の定義

```
並列生産効率 = (使用フィルム幅 ÷ 原反有効幅) × 100%

効率分類:
• 90%以上: 優（★推奨）
• 75-89%: 良好
• 60-74%: 普通
• 60%未満: 並列生産非推奨
```

### 1-3. 割引率設定ロジック

```
【基本割引率計算式】

理論的コスト削減率 = 1 - (1 ÷ 並列本数)
調整後割引率 = 理論的削減率 × 効率係数 × 製造者利益確保率

各変数:
• 並列本数: 実際に並列生産可能な本数
• 効率係数: 有効幅使用率（0.8-1.0）
• 利益確保率: 0.7-0.9（製造者の適正利益維持）

【簡易設定テーブル】
並列本数 → 割引率:
  2本 → 20% OFF（理論50% × 効率0.8 × 利益0.5）
  3本 → 30% OFF（理論67% × 効率0.85 × 利益0.53）
  4本 → 35% OFF（理論75% × 効率0.9 × 利益0.52）
  5本 → 40% OFF（理論80% × 効率0.95 × 利益0.53）
  6本以上 → 40% OFF（上限設定）
```

---

## 2. ロールフィルム完全マトリックス

### 2-1. 全幅範囲の並列生産分析

| ロール幅 | 590mm原反<br>550mm有効 | 760mm原反<br>720mm有効 | 最適提案 | 効率590 | 効率760 |
|---------|---------------------|---------------------|----------|---------|---------|
| **80mm** | 6本（688%） | 9本（100%） | 760mmで9本 | 87% | 100% ⭐ |
| **100mm** | 5本（91%） | 7本（97%） | 760mmで7本 | 91% | 97% ⭐ |
| **120mm** | 4本（87%） | 6本（100%） | 760mmで6本 | 87% | 100% ⭐ |
| **140mm** | 3本（76%） | 5本（97%） | 760mmで5本 | 76% | 97% ⭐ |
| **150mm** | 3本（82%） | 4本（83%） | 590mmで3本 | 82% | 83% |
| **160mm** | 3本（87%） | 4本（89%） | 760mmで4本 | 87% | 89% ⭐ |
| **170mm** | 3本（93%） | 4本（94%） | 760mmで4本 | 93% | 94% ⭐ |
| **180mm** | 3本（98%） | 4本（100%） | 760mmで4本 | 98% | 100% ⭐ |
| **190mm** | 2本（69%） | 3本（79%） | 760mmで3本 | 69% | 79% |
| **200mm** | 2本（73%） | 3本（83%） | 760mmで3本 | 73% | 83% |
| **220mm** | 2本（80%） | 3本（92%） | 760mmで3本 | 80% | 92% ⭐ |
| **240mm** | 2本（87%） | 3本（100%） | 760mmで3本 | 87% | 100% ⭐ |
| **250mm** | 2本（91%） | 2本（69%） | 590mmで2本 | 91% | 69% |
| **260mm** | 2本（95%） | 2本（72%） | 590mmで2本 | 95% | 72% |
| **270mm** | 2本（98%） | 2本（75%） | 590mmで2本 | 98% | 75% |
| **280mm** | 1本（51%） | 2本（78%） | 760mmで2本 | 51% | 78% |
| **290mm** | 1本（53%） | 2本（81%） | 760mmで2本 | 53% | 81% |
| **300mm** | 1本（55%） | 2本（83%） | 760mmで2本 | 55% | 83% |
| **320mm** | 1本（58%） | 2本（89%） | 760mmで2本 | 58% | 89% ⭐ |
| **340mm** | 1本（62%） | 2本（94%） | 760mmで2本 | 62% | 94% ⭐ |
| **350mm** | 1本（64%） | 2本（97%） | 760mmで2本 | 64% | 97% ⭐ |
| **360mm以上** | × | 2本（100%以下） | 標準生産 | - | - |

### 2-2. 最適提案アルゴリズム

```typescript
/**
 * ロールフィルムの最適提案を生成
 */
function generateRollFilmOptimalProposal(
  filmWidthMM: number,
  requestedLength: number
): OptimalProposal {

  // 590mm原反での並列数
  const maxParallel590 = Math.floor(550 / filmWidthMM);

  // 760mm原反での並列数
  const maxParallel760 = Math.floor(720 / filmWidthMM);

  // 効率計算
  const efficiency590 = (filmWidthMM * maxParallel590) / 550;
  const efficiency760 = (filmWidthMM * maxParallel760) / 720;

  // 最適原反選定
  let optimalMaterial: 590 | 760;
  let optimalParallelCount: number;
  let optimalDiscount: number;

  if (maxParallel760 >= 3 && efficiency760 >= 0.90) {
    // 760mmで3本以上、効率90%以上
    optimalMaterial = 760;
    optimalParallelCount = Math.min(maxParallel760, 6); // 上限6本
    optimalDiscount = 0.40; // 40% OFF
  } else if (maxParallel760 > maxParallel590 && efficiency760 > efficiency590) {
    // 760mmの方が効率的
    optimalMaterial = 760;
    optimalParallelCount = maxParallel760;
    optimalDiscount = calculateDiscountByParallelCount(maxParallel760);
  } else if (maxParallel590 >= 2) {
    // 590mmで2本以上
    optimalMaterial = 590;
    optimalParallelCount = maxParallel590;
    optimalDiscount = calculateDiscountByParallelCount(maxParallel590);
  } else {
    // 標準生産
    optimalMaterial = 590;
    optimalParallelCount = 1;
    optimalDiscount = 0;
  }

  return {
    filmWidth: filmWidthMM,
    material: optimalMaterial,
    recommendedOrderCount: optimalParallelCount,
    discount: optimalDiscount,
    efficiency: optimalMaterial === 590 ? efficiency590 : efficiency760,
    message: generateProposalMessage(filmWidthMM, optimalParallelCount, optimalDiscount)
  };
}

/**
 * 並列本数による割引率計算
 */
function calculateDiscountByParallelCount(parallelCount: number): number {
  const discountTable: Record<number, number> = {
    1: 0.00,   // 0%
    2: 0.20,   // 20%
    3: 0.30,   // 30%
    4: 0.35,   // 35%
    5: 0.38,   // 38%
    6: 0.40    // 40%（上限）
  };

  // 6本以上は40% OFFで統一
  if (parallelCount >= 6) return 0.40;

  return discountTable[parallelCount] ?? 0;
}

/**
 * 提案メッセージ生成
 */
function generateProposalMessage(
  filmWidth: number,
  orderCount: number,
  discount: number
): string {
  const material = orderCount >= 6 || filmWidth > 250 ? '760mm' : '590mm';

  if (orderCount === 1) {
    return `${filmWidth}mmロールは標準生産となります`;
  }

  if (discount >= 0.40) {
    return `${material}原反で${orderCount}本同時生産で40% OFF！`;
  }

  return `${material}原反で${orderCount}本セットで${Math.round(discount * 100)}% OFF`;
}
```

### 2-3. 効率クラス別の提案

#### 【クラスA: 効率90%以上（超推奨）】

| ロール幅 | 原反 | 並列数 | 割引 | 効率 |
|---------|------|--------|------|------|
| 80mm | 760mm | 9本 | 40% OFF | 100% |
| 100mm | 760mm | 7本 | 40% OFF | 97% |
| 120mm | 760mm | 6本 | 40% OFF | 100% |
| 140mm | 760mm | 5本 | 38% OFF | 97% |

**メッセージ**: 「760mm原反で【X本】同時生産！フィルム効率【Y】%で40% OFF」

#### 【クラスB: 効率80-89%（推奨）】

| ロール幅 | 原反 | 並列数 | 割引 | 効率 |
|---------|------|--------|------|------|
| 150mm | 590mm | 3本 | 30% OFF | 82% |
| 160mm | 760mm | 4本 | 35% OFF | 89% |
| 170mm | 760mm | 4本 | 35% OFF | 94% |
| 180mm | 760mm | 4本 | 35% OFF | 100% |
| 220mm | 760mm | 3本 | 30% OFF | 92% |
| 240mm | 760mm | 3本 | 30% OFF | 100% |

**メッセージ**: 「並列生産で効率アップ！【X本】セットで【Y】% OFF」

#### 【クラスC: 効率70-79%（標準）】

| ロール幅 | 原反 | 並列数 | 割引 | 効率 |
|---------|------|--------|------|------|
| 190mm | 760mm | 3本 | 30% OFF | 79% |
| 200mm | 760mm | 3本 | 30% OFF | 83% |
| 250mm | 590mm | 2本 | 20% OFF | 91% |
| 260mm | 590mm | 2本 | 20% OFF | 95% |
| 270mm | 590mm | 2本 | 20% OFF | 98% |

**メッセージ**: 「2本セットで20% OFF、3本以上でさらに割引」

#### 【クラスD: 効率70%未満（要検討）**

| ロール幅 | 原反 | 並列数 | 割引 | 効率 | 考慮事項 |
|---------|------|--------|------|------|----------|
| 280mm | 760mm | 2本 | 15% OFF | 78% | 効率低め、2本推奨 |
| 290mm | 760mm | 2本 | 15% OFF | 81% | 効率改善 |
| 300mm | 760mm | 2本 | 20% OFF | 83% | 効率良好 |
| 320mm | 760mm | 2本 | 20% OFF | 89% | 推奨 |
| 340mm | 760mm | 2本 | 20% OFF | 94% | 推奨 |
| 350mm | 760mm | 2本 | 20% OFF | 97% | 推奨 |

**メッセージ**: 「2本並列生産可能、効率【Y】%で20% OFF」

### 2-4. 590mm超過・760mm超過ケース

#### 【フィルム幅 > 550mm（590mm原非対応）】

| ロール幅 | 対応 | 最適提案 | 理由 |
|---------|------|----------|------|
| 280-350mm | 760mm | 2本セット（15-20% OFF） | 760mmでのみ並列可能 |
| 360-540mm | 760mm | 2本セット（20% OFF） | 2本並列、効率100% |
| 550mm以上 | 標準 | 1本注文 | 並列生産不可 |

#### 【フィルム幅 > 720mm（760mm原非対応）】

| ロール幅 | 対応 | 提案 | 理由 |
|---------|------|------|------|
| 730-1000mm | 特別 | 見積り依頼 | 特別対応が必要 |
| 1000mm超 | 分割 | 2分割生産 | 1本を2分割して生産 |

---

## 3. 平袋（3方シール）完全マトリックス

### 3-1. 全縦サイズの2列生産分析

| パウチ縦 (H) | 1列幅 | 2列幅 | 590mm対応 | 760mm対応 | 効率590 | 効率760 |
|-------------|-------|-------|-----------|-----------|---------|---------|
| 50mm | 141mm | 271mm | ○ | ○ | 49% | 38% |
| 60mm | 161mm | 311mm | ○ | ○ | 57% | 43% |
| 70mm | 181mm | 351mm | ○ | ○ | 64% | 49% |
| 80mm | 201mm | 391mm | ○ | ○ | 71% | 54% |
| 90mm | 221mm | 431mm | ○ | ○ | 78% | 60% |
| 100mm | 241mm | 471mm | ○ | ○ | 86% | 65% |
| 110mm | 261mm | 511mm | ○ | ○ | 93% | 71% |
| 115mm | 271mm | 531mm | ○ | ○ | 97% | 74% |
| **120mm** | **281mm** | **551mm** | **○** | **○** | **100%** | **77%** ⭐ |
| **125mm** | **291mm** | **571mm** | **×** | **○** | **-** | **79%** |
| **130mm** | **301mm** | **591mm** | **×** | **○** | **-** | **82%** |
| **135mm** | **311mm** | **611mm** | **×** | **×** | **-** | **85%** |
| **140mm** | **321mm** | **631mm** | **×** | **×** | **-** | **88%** |
| 150mm | 341mm | 671mm | × | × | - | 93% |

### 3-2. 最適提案テーブル

| 縦サイズ | 最適原反 | 最小数量 | 割引 | 根拠 |
|----------|----------|----------|------|------|
| **H ≤ 100mm** | 590mm | 5,000個 | **35% OFF** | 効率65-86%、2列生産有効 |
| **H = 110-120mm** | 590mm | 5,000個 | **40% OFF** | 効率93-100%、最適 |
| **H = 125-130mm** | 760mm | 5,000個 | **35% OFF** | 760mm専用、効率79-82% |
| **H = 135-140mm** | 760mm | 10,000個 | **30% OFF** | 2列生産可能だが効率85-88%、数量倍で割引増 |
| **H ≥ 150mm** | 標準 | 3,000個 | **15% OFF** | 2列生産非効率的、数量割引のみ |

### 3-3. 数値根拠

**H = 120mm（最適ケース）**
```
2列フィルム幅 = 551mm
590mm有効幅 = 550mm（両端10mm除外）
効率 = 551 ÷ 550 = 100% ⊛ 完全活用

理論メートル数（10,000個）:
  1列: 950m + 400mロス = 1350m
  2列: 475m + 400mロス = 875m

削減率 = 1350 ÷ 875 - 1 = 54%（フィルム使用量）
調整後割引 = 54% × 0.8 × 0.9 = 39% → 40% OFFに設定
```

**H = 135mm（境界ケース）**
```
2列フィルム幅 = 611mm > 720mm（760mm使用不可）
→ 760mm原反でも2列生産不可

対応策:
• 標準1列生産: 15% OFF（数量割引）
• または760mm原反1列生産: 通常価格
```

---

## 4. スタンドアップパウチ完全マトリックス

### 4-1. マチG=50mm基準の全分析

| パウチ縦 (H) | マチ(G) | 1列幅 | 2列幅 | 590mm対応 | 760mm対応 | 効率760 |
|-------------|----------|-------|-------|-----------|-----------|---------|
| 60mm | 50mm | 205mm | 330mm | ○ | ○ | 46% |
| 70mm | 50mm | 225mm | 370mm | ○ | ○ | 51% |
| 80mm | 50mm | 245mm | 410mm | ○ | ○ | 57% |
| 90mm | 50mm | 265mm | 450mm | ○ | ○ | 63% |
| 100mm | 50mm | 285mm | 490mm | ○ | ○ | 68% |
| 110mm | 50mm | 305mm | 530mm | ○ | ○ | 74% |
| **115mm** | **50mm** | **315mm** | **550mm** | **○** | **○** | **76%** |
| **120mm** | **50mm** | **325mm** | **570mm** | **○** | **○** | **79%** |
| **125mm** | **50mm** | **335mm** | **590mm** | **×** | **○** | **82%** |
| 130mm | 50mm | 345mm | 610mm | × | × | - |

### 4-2. マチサイズの影響分析

| マチ (G) | H=100mmの2列幅 | 590mm対応 | 760mm対応 | 影響 |
|-----------|----------------|-----------|-----------|------|
| **40mm** | 480mm | ○ | ○ | 効率良好 |
| **50mm** | 490mm | ○ | ○ | 基準 |
| **60mm** | 500mm | ○ | ○ | 効率低下 |
| **70mm** | 510mm | ○ | ○ | 効率さらに低下 |
| **80mm** | 520mm | × | ○ | 760mm専用 |
| **90mm** | 530mm | × | ○ | 760mm専用 |
| **100mm** | 540mm | × | ○ | 760mm専用 |

### 4-3. 最適提案テーブル

| 縦サイズ | マチ | 最適原反 | 最小数量 | 割引 | 根拠 |
|----------|------|----------|----------|------|------|
| **H ≤ 110mm、G ≤ 60mm** | - | 590mm | 5,000個 | **35% OFF** | 効率68-74% |
| **H = 115-120mm、G ≤ 50mm** | - | 590mm | 5,000個 | **40% OFF** | 効率76-79%、最適 |
| **H = 125mm、G ≤ 60mm** | - | 760mm | 5,000個 | **30% OFF** | 760mm専用、効率82-86% |
| **H ≥ 130mmまたはG ≥ 70mm** | - | 標準 | 3,000個 | **15% OFF** | 2列生産不利 |

---

## 5. 合掌袋（T-shape）完全マトリックス

### 5-1. 全幅範囲の並列生産分析

| パウチ幅 (W) | フィルム幅 | 590mm並列数 | 760mm並列数 | 効率590 | 効率760 |
|-------------|-----------|-------------|-------------|---------|---------|
| 60mm | 142mm | **3本** | **5本** | 78% | 42% |
| 70mm | 162mm | **3本** | **4本** | 88% | 56% |
| 80mm | 182mm | **3本** | **3本** | 99% ⭐ | 76% |
| **90mm** | **202mm** | **2本** | **3本** | 73% | 84% |
| **100mm** | **222mm** | **2本** | **3本** | 81% | 92% |
| 110mm | 242mm | **2本** | **2本** | 88% | 67% |
| **120mm** | **262mm** | **2本** | **2本** | 95% ⭐ | 73% |
| 130mm | 282mm | **1本** | **2本** | 51% | 78% |
| 140mm | 302mm | **1本** | **2本** | 55% | 84% |
| **150mm** | **322mm** | **1本** | **2本** | 59% | 89% |
| 160mm | 342mm | **1本** | **2本** | 62% | 95% ⭐ |
| **170mm** | **362mm** | **×** | **2本** | - | 50%（非効率） |
| 180mm | 382mm | × | **1本** | - | 53% |
| 190mm | 402mm | × | **1本** | - | 56% |
| **200mm** | **422mm** | × | **1本** | - | 59% |

### 5-2. 最適提案テーブル

| パウチ幅 | 最適原反 | 最適注文 | 割引 | 根拠 |
|-------------|----------|----------|------|------|
| **W ≤ 80mm** | 590mm | **3本セット** | **30% OFF** | 効率99%、最適 |
| **W = 90-120mm** | 590mm | **2本セット** | **20% OFF** | 効率81-95%、推奨 |
| **W = 130-160mm** | 760mm | **2本セット** | **20% OFF** | 効率78-95%、760mm専用 |
| **W ≥ 170mm** | 標準 | 1本 | 0% | 並列生産非効率 |

### 5-3. 数値根拠

**W = 80mm（最適ケース）**
```
フィルム幅 = 182mm
590mm有効幅 = 550mm
最大並列数 = 550 ÷ 182 = 3.02 → 3本
効率 = 182 × 3 ÷ 550 = 99% ⊛ ほぼ完璧

コスト削減:
  理論削減率 = 1 - (1/3) = 67%
  調整後割引 = 67% × 0.99 × 0.45 = 30% OFF
```

**W = 170mm（境界ケース）**
```
フィルム幅 = 362mm
760mm有効幅 = 720mm
最大並列数 = 720 ÷ 362 = 1.99 → 2本（非効率）
効率 = 362 × 2 ÷ 720 = 50%

対応策:
• 1本標準生産が推奨
• または2本セットでも割引なし（効率50%未満のため）
```

---

## 6. ボックスパウチ（M-shape）完全マトリックス

### 6-1. マチG=50mm基準の全分析

| パウチ幅 (W) | マチ(G) | フィルム幅 | 590mm並列数 | 760mm並列数 | 効率760 |
|-------------|----------|-----------|-------------|-------------|---------|
| 60mm | 50mm | 222mm | **2本** | **3本** | 93% ⭐ |
| 70mm | 50mm | 242mm | **2本** | **2本** | 67% |
| 80mm | 50mm | 262mm | **2本** | **2本** | 73% |
| 90mm | 50mm | 282mm | **1本** | **2本** | 78% |
| 100mm | 50mm | 302mm | **1本** | **2本** | 84% |
| 110mm | 50mm | 322mm | × | **2本** | 89% |
| 120mm | 50mm | 342mm | × | **2本** | 95% ⭐ |

### 6-2. マチサイズの影響

| マチ (G) | W=80mmのフィルム幅 | 590mm対応 | 760mm対応 | 影響 |
|-----------|------------------|-----------|-----------|------|
| **40mm** | 240mm | **2本** | **3本** | 効率100% ⭐ |
| **50mm** | 260mm | **2本** | **2本** | 効率72% |
| **60mm** | 280mm | **1本** | **2本** | 760mm専用 |
| **70mm** | 300mm | **1本** | **2本** | 760mm専用 |
| **80mm** | 320mm | × | **2本** | 760mm専用 |

### 6-3. 最適提案テーブル

| パウチ幅 | マチ | 最適原反 | 最適注文 | 割引 | 根拠 |
|-------------|------|----------|----------|------|------|
| **W = 60mm、G ≤ 60mm** | - | 760mm | **3本セット** | **30% OFF** | 効率93% |
| **W = 70-100mm、G ≤ 50mm** | - | 760mm | **2本セット** | **20% OFF** | 効率73-95% |
| **W = 110-120mm、G ≤ 50mm** | - | 760mm | **2本セット** | **20% OFF** | 効率89-95% |
| **W ≥ 130mmまたはG ≥ 60mm** | - | 標準 | 1本 | 0% | 効率低いまたは並列不可 |

---

## 7. 境界値の決定ルール

### 7-1. 効率基準による境界値

```
【並列生産推奨基準】

効率75%以上 → 並列生産推奨（★）
  → 2列生産: 40% OFF
  → 2-3本並列: 20-30% OFF

効率60-74% → 並列生産標準
  → 2列生産: 35% OFF
  → 2本並列: 15-20% OFF

効率60%未満 → 並列生産非推奨
  → 標準生産へ
  → 数量割引のみ適用
```

### 7-2. 原反選定の境界値

```typescript
/**
 * 原反選定アルゴリズム
 */
function determineMaterialWidth(
  filmWidthMM: number,
  parallelCount: number = 1
): { material: 590 | 760; reason: string } {

  const requiredWidth = filmWidthMM * parallelCount;

  // 590mm原反対応可能
  if (requiredWidth <= 550) {
    return {
      material: 590,
      reason: `フィルム幅${filmWidthMM}mm × ${parallelCount}並列 = ${requiredWidth}mm ≤ 550mm（590mm有効幅）`
    };
  }

  // 760mm原反対応可能
  if (requiredWidth <= 720) {
    return {
      material: 760,
      reason: `フィルム幅${filmWidthMM}mm × ${parallelCount}並列 = ${requiredWidth}mm ≤ 720mm（760mm有効幅）`
    };
  }

  // どちらの原反でも対応不可
  return {
    material: 760, // デフォルト
    reason: `フィルム幅${filmWidthMM}mm × ${parallelCount}並列 = ${requiredWidth}mm > 720mm（760mm有効幅）、標準生産を推奨`
  };
}
```

### 7-3. 最適注文数の境界値

```typescript
/**
 * 最適注文数計算アルゴリズム
 */
function calculateOptimalOrderCount(
  filmWidthMM: number,
  materialWidth: 590 | 760
): { optimalCount: number; discount: number; message: string } {

  const effectiveWidth = materialWidth === 590 ? 550 : 720;
  const maxParallel = Math.floor(effectiveWidth / filmWidthMM);

  // 効率計算
  const efficiency = (filmWidthMM * maxParallel) / effectiveWidth;

  // 効率による分類
  if (efficiency >= 0.90) {
    return {
      optimalCount: maxParallel,
      discount: 0.40,
      message: `効率${Math.round(efficiency * 100)}%で40% OFF`
    };
  }

  if (efficiency >= 0.80) {
    return {
      optimalCount: maxParallel,
      discount: 0.35,
      message: `効率${Math.round(efficiency * 100)}%で35% OFF`
    };
  }

  if (efficiency >= 0.70) {
    return {
      optimalCount: Math.min(maxParallel, 2), // 最大2本に制限
      discount: 0.20,
      message: `効率${Math.round(efficiency * 100)}%で20% OFF`
    };
  }

  // 効率70%未満は並列生産非推奨
  return {
    optimalCount: 1,
    discount: 0,
    message: `効率${Math.round(efficiency * 100)}%未満のため標準生産推奨`
  };
}
```

---

## 8. 実装用設定データ

### 8-1. ロールフィルム完全設定

```typescript
// ロールフィルム並列生産設定
interface RollFilmParallelSetting {
  filmWidth: number;
  material590: {
    maxParallel: number;
    efficiency: number;
    optimalDiscount: number;
    recommended: boolean;
  };
  material760: {
    maxParallel: number;
    efficiency: number;
    optimalDiscount: number;
    recommended: boolean;
  };
  optimal: {
    material: 590 | 760;
    orderCount: number;
    discount: number;
  };
}

const ROLL_FILM_SETTINGS: RollFilmParallelSetting[] = [
  { filmWidth: 80,
    material590: { maxParallel: 6, efficiency: 0.87, optimalDiscount: 0.38, recommended: false },
    material760: { maxParallel: 9, efficiency: 1.00, optimalDiscount: 0.40, recommended: true },
    optimal: { material: 760, orderCount: 9, discount: 0.40 }
  },
  { filmWidth: 100,
    material590: { maxParallel: 5, efficiency: 0.91, optimalDiscount: 0.38, recommended: false },
    material760: { maxParallel: 7, efficiency: 0.97, optimalDiscount: 0.40, recommended: true },
    optimal: { material: 760, orderCount: 7, discount: 0.40 }
  },
  { filmWidth: 120,
    material590: { maxParallel: 4, efficiency: 0.87, optimalDiscount: 0.30, recommended: false },
    material760: { maxParallel: 6, efficiency: 1.00, optimalDiscount: 0.40, recommended: true },
    optimal: { material: 760, orderCount: 6, discount: 0.40 }
  },
  { filmWidth: 140,
    material590: { maxParallel: 3, efficiency: 0.76, optimalDiscount: 0.30, recommended: false },
    material760: { maxParallel: 5, efficiency: 0.97, optimalDiscount: 0.38, recommended: true },
    optimal: { material: 760, orderCount: 5, discount: 0.38 }
  },
  { filmWidth: 150,
    material590: { maxParallel: 3, efficiency: 0.82, optimalDiscount: 0.30, recommended: true },
    material760: { maxParallel: 4, efficiency: 0.83, optimalDiscount: 0.30, recommended: false },
    optimal: { material: 590, orderCount: 3, discount: 0.30 }
  },
  { filmWidth: 200,
    material590: { maxParallel: 2, efficiency: 0.73, optimalDiscount: 0.20, recommended: false },
    material760: { maxParallel: 3, efficiency: 0.83, optimalDiscount: 0.30, recommended: true },
    optimal: { material: 760, orderCount: 3, discount: 0.30 }
  },
  { filmWidth: 250,
    material590: { maxParallel: 2, efficiency: 0.91, optimalDiscount: 0.20, recommended: true },
    material760: { maxParallel: 2, efficiency: 0.69, optimalDiscount: 0.15, recommended: false },
    optimal: { material: 590, orderCount: 2, discount: 0.20 }
  },
  { filmWidth: 300,
    material590: { maxParallel: 1, efficiency: 0.55, optimalDiscount: 0, recommended: false },
    material760: { maxParallel: 2, efficiency: 0.83, optimalDiscount: 0.20, recommended: true },
    optimal: { material: 760, orderCount: 2, discount: 0.20 }
  },
  { filmWidth: 350,
    material590: { maxParallel: 1, efficiency: 0.64, optimalDiscount: 0, recommended: false },
    material760: { maxParallel: 2, efficiency: 0.97, optimalDiscount: 0.20, recommended: true },
    optimal: { material: 760, orderCount: 2, discount: 0.20 }
  },
  { filmWidth: 400,
    material590: { maxParallel: 0, efficiency: 0, optimalDiscount: 0, recommended: false },
    material760: { maxParallel: 1, efficiency: 0.56, optimalDiscount: 0, recommended: false },
    optimal: { material: 760, orderCount: 1, discount: 0 }
  }
];
```

### 8-2. 平袋・スタンドアップ2列生産設定

```typescript
// 2列生産設定
interface TwoColumnSetting {
  pouchType: 'flat_3_side' | 'stand_up';
  maxHeight590: number;     // 590mm原反で2列可能な最大H
  maxHeight760: number;     // 760mm原反で2列可能な最大H
  minQuantity: number;       // 2列生産の最小数量
  discount: number;          // 割引率
  efficiency590: number;    // 590mmでの効率
  efficiency760: number;    // 760mmでの効率
}

const TWO_COLUMN_SETTINGS: TwoColumnSetting[] = [
  { pouchType: 'flat_3_side',
    maxHeight590: 120, maxHeight760: 130,
    minQuantity: 5000, discount: 0.40,
    efficiency590_at_120: 1.00, efficiency760_at_120: 0.77
  },
  { pouchType: 'stand_up',
    maxHeight590: 120, maxHeight760: 125,
    minQuantity: 5000, discount: 0.40,
    depth: 50, // マチ基準
    efficiency590_at_120: 0.79, efficiency760_at_120: 0.82
  }
];
```

---

## 9. 割引率決定ロジック

### 9-1. 効率ベース割引テーブル

```typescript
/**
 * 効率に基づく割引率計算
 */
function calculateDiscountByEfficiency(
  parallelCount: number,
  efficiency: number
): number {

  // 効率クラス分類
  if (efficiency >= 0.90) {
    // 効率90%以上: 超推奨
    return parallelCount >= 5 ? 0.40 :  // 5本以上で40% OFF
           parallelCount >= 3 ? 0.35 :  // 3本以上で35% OFF
           parallelCount === 2 ? 0.30 : 0.20; // 2本で30% OFF
  }

  if (efficiency >= 0.80) {
    // 効率80-89%: 良好
    return parallelCount >= 4 ? 0.35 :
           parallelCount >= 2 ? 0.25 : 0.20;
  }

  if (efficiency >= 0.70) {
    // 効率70-79%: 標準
    return parallelCount >= 2 ? 0.20 : 0;
  }

  // 効率70%未満: 非推奨
  return 0; // 割引なし
}

/**
 * 簡易割引テーブル（実装用）
 */
function getDiscountByParallelCount(parallelCount: number): number {
  const table: Record<number, number> = {
    1: 0.00,
    2: 0.20,
    3: 0.30,
    4: 0.35,
    5: 0.38,
    6: 0.40
  };

  if (parallelCount >= 6) return 0.40;
  return table[parallelCount] ?? 0;
}
```

---

## 10. UI表示例

### 10-1. ロールフィルム

```
┌─────────────────────────────────────────────────────────────┐
│  200mm × 500m ロールフィルム                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  💡 お得なご提案                                           │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ⭐ 推奨: 760mm原反で3本セット                       │  │
│  │                                                      │  │
│  │  3本同時生産で大幅コスト削減！                         │  │
│  │  フィルム効率: 83%                                    │  │
│  │                                                      │  │
│  │  【価格比較】                                         │  │
│  │  1本注文: ¥100,000                                  │  │
│  │  3本注文: ¥210,000（1本あたり¥70,000）              │  │
│  │  通常価格: ¥300,000                                  │  │
│  │                                                      │  │
│  │  お得額: -¥90,000（30% OFF）                         │  │
│  │                                                      │  │
│  │  [3本セットで見積もる] ボタン                          │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  その他のオプション                                         │
│  • 590mm原反で2本: 20% OFF（効率73%）                  │
│  • 1本のみ: 標準価格                                     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 10-2. 平袋

```
┌─────────────────────────────────────────────────────────────┐
│  平袋 120mm × 180mm × 10,000個                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  💡 お得なご提案                                           │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ⭐ 推奨: 2列生産                                     │  │
│  │                                                      │  │
│  │  590mm原反で2列同時生産                               │  │
│  │  フィルム効率: 100%（完全活用）                    │  │
│  │                                                      │  │
│  │  【価格比較】                                         │  │
│  │  標準生産（1列）: ¥1,000,000                      │  │
│  │  2列生産: ¥600,000                                  │  │
│  │                                                      │  │
│  │  お得額: -¥400,000（40% OFF）                        │  │
│  │   単価: ¥60/個（通常¥100/個）                        │  │
│  │                                                      │  │
│  │  [2列生産で見積もる] ボタン                          │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  対象: 各SKUが5,000個以上の注文                            │
└─────────────────────────────────────────────────────────────┘
```

---

## 11. まとめ

### 11-1. 体系的な価格設定ルール

```
【ステップ1: 原反選定】
フィルム幅 × 並列数 ≤ 有効幅（590mm:550mm、760mm:720mm）
→ 条件を満たす最大の原反を選択

【ステップ2: 効率計算】
効率 = (フィルム幅 × 並列数) ÷ 有効幅

【ステップ3: 割引決定】
効率 ≥ 90% → 40% OFF（超推奨）
効率 80-89% → 30-35% OFF（推奨）
効率 70-79% → 20% OFF（標準）
効率 < 70% → 割引なし（非推奨）
```

### 11-2. 製品別最適戦略

| 製品 | 最適条件 | 最大割引 | 最小数量 |
|------|----------|----------|----------|
| ロール | 幅80-120mm、760mm | 40% OFF | 3-9本 |
| 平袋 | H ≤ 120mm | 40% OFF | 5,000個 |
| スタンド | H ≤ 120mm、G ≤ 60mm | 40% OFF | 5,000個 |
| 合掌 | W ≤ 120mm | 30% OFF | 2-3本 |
| ボックス | W ≤ 120mm、G ≤ 50mm | 20% OFF | 2本 |

---

**作成日**: 2026-01-17
**バージョン**: 2.0（完全版）
