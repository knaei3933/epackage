# 03. 列数判定と原反選定

> **対象**: 2列自動判定ロジックと原反選定
> **更新日**: 2026-01-29（最適列数自動判定ロジック追加）

---

> **Navigation**: [← Prev: 02. フィルム幅計算](./02-필름폭_계산공식.md) | [🏠 Home](./00-README.md) | [Next: 04. 原料計算 →](./04-미터수_및_원가_계산.md)

---

## 目次

1. [列数自動判定ロジック](#1-列数自動判定ロジック)
2. [原反選定フロー](#2-原反選定フロー)
3. [マルチロール並列生産](#3-マルチロール並列生産)
4. [原反最小確保量と追加単位](#4-原反最小確保量と追加単位)

---

## 1. 列数自動判定ロジック

### 1-1. 基本アルゴリズム（パウチ）

```
IF (理論メートル >= 1000m AND 2列フィルム幅 <= 740mm) THEN
  → 2列採用（760mm原反使用）
ELSE
  → 1列採用（適切な幅の原反使用）
END IF
```

> **重要**: 2列生産には理論メートル1000m以上が必要

### 1-2. 各パウチタイプの判定条件

| パウチタイプ | サイズ | 1列フィルム幅 | 2列フィルム幅 | 判定結果 |
|-------------|--------|--------------|--------------|----------|
| 平袋 | H=100 | 241mm | 471mm | **2列採用** (471 < 740) |
| 平袋 | H=120 | 281mm | 551mm | **2列採用** (551 < 740) |
| 平袋 | H=160 | 361mm | 711mm | **2列採用** (711 < 740) |
| 平袋 | H=180 | 401mm | 791mm | **1列採用** (791 > 740) |
| スタンド | H=130, G=30 | 325mm | 590mm | **2列採用** (590 < 740) |
| スタンド | H=180, G=40 | 435mm | 760mm | **1列採用** (760 > 740) |

### 1-3. 基本アルゴリズム（ロールフィルム）

```
最大印刷可能幅 = 740mm（760mm原反の両端10mm除外）
最大列数 = FLOOR(最大印刷可能幅 / ロール幅)

IF (理論メートル >= 1000m) THEN
  → 可能な最大列数採用（最大7列）
ELSE
  → 1列採用
END IF
```

> **重要**: ロールフィルムは最大7列まで並列生産可能

### 1-4. ロールフィルムの列数判定例

| ロール幅 | 理論メートル | 最大列数 | 採用列数 | フィルム幅 |
|---------|-------------|---------|---------|-----------|
| 100mm | 500m | 7列 | **1列** | 100mm |
| 100mm | 1500m | 7列 | **7列** | 700mm |
| 130mm | 1200m | 5列 | **5列** | 650mm |
| 150mm | 2000m | 4列 | **4列** | 600mm |

### 1-5. 2列採用時のメリット

| 項目 | 1列 | 2列 | 効果 |
|------|-----|-----|------|
| 必要メートル数 | X | X ÷ 2 | **半減** |
| 原反効率 | 40~60% | 80~96% | **大幅向上** |
| 原価 | 100% | **70%** | **30%削減** 💡 |

> **結論**: 2列で生産可能な場合は**必ず2列**を採用する
> **重要**: 2列生産の原価削減（30%）は顧客と販売者で配分

---

## 2. 原反選定フロー

### 2-1. 利用可能な原反

| 原反幅 | 印刷可能幅 | 説明 | 最小発注量 |
|--------|-----------|------|-----------|
| **590mm** | 570mm | 標準的な小・中型パウチ用 | 500m |
| **760mm** | 740mm | 大型パウチまたは2列印刷用 | 500m |

> **重要**: 原材料費計算は実際の原反幅（590mm, 760mm）で計算し、印刷可能幅は両端10mmずつ除外した幅

### 2-2. 原反選定フローチャート

```
パウチサイズ入力
   ↓
2列フィルム幅計算
   ↓
2列幅 ≤ 740mm?
   ├─ YES → 760mm原反×2列採用
   └─ NO  → 1列フィルム幅計算
              ↓
         1列幅 ≤ 570mm?
              ├─ YES → 590mm原反×1列採用
              └─ NO  → 760mm原反×1列採用
```

### 2-3. 原反選定例

| パウチタイプ | サイズ | フィルム幅 | 選定原反 | 理由 |
|-------------|--------|-----------|---------|------|
| 平袋 | H=100 | 1列:241mm, 2列:471mm | **760mm** | 2列採用 (471 < 740) |
| 平袋 | H=180 | 1列:401mm, 2列:791mm | **590mm** | 1列採用 (791 > 740) |
| スタンド | H=130, G=30 | 1列:325mm, 2列:590mm | **760mm** | 2列採用 (590 < 740) |
| 合掌 | W=60 | 1列:142mm | **590mm** | 1列のみ、570mm以下 |

---

## 3. マルチロール並列生産

合掌袋（T封）とボックスパウチ（M封）は2列生産がありません。代わりに**マルチロール並列生産**で最適化します。

### 3-1. 最適化アルゴリズム

```
現在のフィルム幅 = 計算式に基づく1列幅
利用可能な原反 = [590mm, 760mm]

FOR EACH 原反幅 DO
  有効幅 = 原反幅 - 20mm（両端余白）
  並列本数 = FLOOR(有効幅 / 現在のフィルム幅)

  IF (並列本数 > 最高並列本数) THEN
    最高並列本数 = 並列本数
    最適原反幅 = 現在の原反幅
  END IF
END FOR

フィルム使用量削減率 = (並列本数 - 1) × 100%
```

### 3-2. 計算例

| パウチタイプ | サイズ | フィルム幅 | 最適原反 | 並列本数 | 効率改善 |
|-------------|--------|-----------|---------|---------|---------|
| 合掌袋 | W=60mm | 142mm | 590mm | 4本 | 75%削減 |
| 合掌袋 | W=100mm | 222mm | 760mm | 3本 | 67%削減 |
| ボックス | W=50, G=90 | 312mm | 760mm | 2本 | 50%削減 |

### 3-3. マルチロール生産のメリット

- 合掌袋・ボックスパウチは2列生産ができない
- 複数のロールを並列で同時生産することで効率化
- フィルム使用量を大幅に削減可能

---

## 4. 原反最小確保量と追加単位

### 4-1. 商品タイプ別ルール

> **重要**: ロスは**同じピッチ（パウチ）または同じ幅（ロール）のSKUグループごとに400m固定**

#### パウチ商品

| 項目 | 設定値 |
|------|--------|
| **最小確保量** | **なし**（1m単位でOK） |
| **切り上げ単位** | 1m単位 |
| **ロス** | 同じピッチのSKUグループごとに**400m固定** |

#### ロールフィルム商品

| SKU数 | 各SKU最小確保量 | 切り上げ単位 |
|--------|-----------------|-------------|
| **1種類** | 500m | 50m単位 |
| **2種類以上** | 各300m | 50m単位 |

| 項目 | 設定値 |
|------|--------|
| **ロス** | 同じ幅のSKUグループごとに**400m固定** |

### 4-2. 確保量計算フロー

#### パウチ商品

```
// 同じピッチのSKUをグループ化
FOR EACH ピッチグループ DO
  // 理論メートル数を合計
  理論メートル数合計 = Σ(各SKU数量 ÷ (1000mm ÷ ピッチ))

  // 1m単位で切り上げ（最小確保量なし）
  確保量 = CEILING(理論メートル数合計, 1m)

  // ロス追加（グループごとに400m）
  グループ総発注量 = 確保量 + 400m
END FOR
```

#### ロールフィルム商品

```
// 同じ幅のSKUをグループ化
FOR EACH 幅グループ DO
  // 理論メートル数を合計
  理論メートル数合計 = Σ(各SKU数量 ÷ (1000mm ÷ ピッチ))

  // 最小確保量適用
  IF SKU数 = 1 THEN
    最小確保量 = 500m
  ELSE
    最小確保量 = 300m × SKU数
  END IF

  // 確保量決定（50m単位で切り上げ）
  IF 理論メートル数合計 ≤ 最小確保量 THEN
    確保量 = 最小確保量
  ELSE
    確保量 = CEILING(理論メートル数合計, 50m)
  END IF

  // ロス追加（グループごとに400m）
  グループ総発注量 = 確保量 + 400m
END FOR
```

### 4-3. 計算例

#### ケース1: パウチ 2SKU（同じピッチ）

| 項目 | SKU 1 | SKU 2 | 合計 |
|------|-------|-------|------|
| 数量 | 500個 | 500個 | 1000個 |
| ピッチ | 120mm | 120mm | 同一グループ |
| 理論メートル数 | 60m | 60m | 120m |
| 確保量 | - | - | **120m**（1m単位、最小制限なし） |
| ロス | - | - | **400m**（グループごと） |
| **総発注量** | - | - | **520m** |

#### ケース2: ロールフィルム 2SKU（同じ幅）

| 項目 | SKU 1 | SKU 2 | 合計 |
|------|-------|-------|------|
| 数量 | 500m | 500m | 1000m |
| 各最小確保量 | 300m | 300m | 600m |
| 確保量 | - | - | **600m**（理論値以上、最小量適用） |
| ロス | - | - | **400m**（グループごと） |
| **総発注量** | - | - | **1000m** |

---

## 5. 重要ポイントのまとめ

| 項目 | パウチ | ロールフィルム |
|------|--------|--------------|
| **2列採用条件** | 2列幅 ≤ 740mm | - |
| **原反幅** | 590mm, 760mm | 590mm, 760mm |
| **印刷可能幅** | 原反幅 - 20mm | 原反幅 - 20mm |
| **ロス（損失）** | 400m/グループ（同じピッチ） | 400m/グループ（同じ幅） |
| **最小確保量（1SKU）** | なし | 500m |
| **最小確保量（2+SKU）** | なし | 各300m |
| **切り上げ単位** | 1m単位 | 50m単位 |
| **総発注量** | 確保量 + 400m | 確保量（50m単位）+ 400m |

---

## 6. 次のステップ

列数判定と原反選定を理解したら、次はメートル数と原価計算を学びます：

- [`04-미터수_및_원가_계산.md`](./04-미터수_및_원가_계산.md) - メートル数計算と原材料費

> [Next: 04. メートル数と原価計算 →](./04-미터수_및_원가_계산.md)

---

**更新日**: 2026-01-29（最適列数自動判定ロジック追加）
